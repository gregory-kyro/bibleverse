<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>BibleVerse</title>
  <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 32 32'><defs><linearGradient id='g' x1='0' y1='0' x2='0' y2='1'><stop offset='0' stop-color='%23f0d878'/><stop offset='1' stop-color='%23a07828'/></linearGradient></defs><path d='M14 2h4v28h-4zM8 9h16v4H8z' fill='url(%23g)'/></svg>">
  <link rel="apple-touch-icon" href="apple-touch-icon.png">
  <link rel="stylesheet" href="css/style.css">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.css">
  <script src="https://cdn.plot.ly/plotly-2.35.2.min.js"></script>
  <script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.js"></script>
  <script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/contrib/auto-render.min.js"></script>
  <script>
    document.addEventListener('DOMContentLoaded', function () {
      var checkKatex = setInterval(function () {
        if (typeof renderMathInElement === 'function') {
          clearInterval(checkKatex);
          renderMathInElement(document.body, {
            delimiters: [
              { left: '$$', right: '$$', display: true },
              { left: '\\(', right: '\\)', display: false }
            ]
          });
        }
      }, 100);
    });
  </script>
  <style>
    html, body { height: 100%; margin: 0; }
    body { background: #000; overflow: hidden; }
    .page-wrap {
      display: flex;
      flex-direction: column;
      height: 100vh;
    }

    /* --- Mobile notice --- */
    .mobile-notice-overlay {
      display: none;
      position: fixed;
      inset: 0;
      z-index: 99999;
      background: rgba(0,0,0,0.75);
      backdrop-filter: blur(12px);
      -webkit-backdrop-filter: blur(12px);
      align-items: center;
      justify-content: center;
      padding: 32px;
    }
    .mobile-notice {
      max-width: 380px;
      width: 100%;
      background: rgba(14,14,22,0.95);
      border: 1px solid rgba(201,168,76,0.12);
      border-radius: 20px;
      padding: 40px 32px 32px;
      text-align: center;
    }
    .mobile-notice-icon {
      font-size: 2.2rem;
      margin-bottom: 18px;
      opacity: 0.8;
    }
    .mobile-notice h2 {
      font-family: var(--font);
      font-size: 1.8rem;
      font-weight: 600;
      color: rgba(232,228,220,0.88);
      letter-spacing: -0.02em;
      margin: 0 0 12px;
    }
    .mobile-notice p {
      font-family: var(--sans);
      font-size: 1.2rem;
      color: rgba(232,228,220,0.5);
      line-height: 1.65;
      margin: 0 0 28px;
    }
    .mobile-notice-btn {
      background: rgba(201,168,76,0.12);
      border: 1px solid rgba(201,168,76,0.18);
      border-radius: 12px;
      color: rgba(232,228,220,0.8);
      font-family: var(--sans);
      font-size: 1.2rem;
      font-weight: 500;
      padding: 14px 36px;
      cursor: pointer;
      transition: all 0.2s;
      letter-spacing: 0.01em;
    }
    .mobile-notice-btn:hover {
      background: rgba(201,168,76,0.2);
      color: rgba(232,228,220,0.95);
    }
    .mobile-notice-url {
      font-family: var(--mono);
      font-size: 0.9rem;
      color: rgba(201,168,76,0.45);
      letter-spacing: 0.04em;
      margin-top: 8px;
    }

    /* --- Onboarding walkthrough --- */
    .walkthrough-overlay {
      display: none;
      position: fixed;
      inset: 0;
      z-index: 90000;
    }
    .walkthrough-overlay.active { display: block; }
    .walkthrough-highlight {
      position: fixed;
      border-radius: 12px;
      box-shadow: 0 0 0 9999px rgba(0,0,0,0.6);
      z-index: 90001;
      pointer-events: none;
      transition: all 0.5s cubic-bezier(0.4, 0, 0.2, 1);
    }
    .walkthrough-tooltip {
      position: absolute;
      z-index: 90002;
      max-width: 320px;
      background: rgba(18,18,28,0.97);
      border: 1px solid rgba(201,168,76,0.18);
      border-radius: 14px;
      padding: 22px 26px 20px;
      box-shadow: 0 12px 48px rgba(0,0,0,0.5);
      transition: all 0.5s cubic-bezier(0.4, 0, 0.2, 1);
      opacity: 0;
      transform: translateY(8px);
    }
    .walkthrough-tooltip.visible {
      opacity: 1;
      transform: translateY(0);
    }
    .walkthrough-tooltip::before {
      content: '';
      position: absolute;
      width: 12px;
      height: 12px;
      background: rgba(18,18,28,0.97);
      border-top: 1px solid rgba(201,168,76,0.18);
      border-left: 1px solid rgba(201,168,76,0.18);
      transform: rotate(45deg);
    }
    .walkthrough-tooltip.arrow-top::before {
      top: -7px;
      left: var(--arrow-left, 50%);
      margin-left: -6px;
    }
    .walkthrough-tooltip.arrow-bottom::before {
      bottom: -7px;
      left: var(--arrow-left, 50%);
      margin-left: -6px;
      transform: rotate(225deg);
    }
    .walkthrough-step-label { display: none; }
    .walkthrough-title {
      font-family: var(--font);
      font-size: 1rem;
      font-weight: 600;
      color: rgba(232,228,220,0.9);
      margin-bottom: 8px;
      letter-spacing: -0.01em;
    }
    .walkthrough-desc {
      font-family: var(--sans);
      font-size: 0.78rem;
      color: rgba(232,228,220,0.5);
      line-height: 1.6;
      margin-bottom: 18px;
    }
    .walkthrough-actions {
      display: flex;
      align-items: center;
      justify-content: space-between;
    }
    .walkthrough-skip {
      background: none;
      border: none;
      color: rgba(232,228,220,0.3);
      font-family: var(--sans);
      font-size: 0.72rem;
      cursor: pointer;
      padding: 4px 0;
      transition: color 0.2s;
    }
    .walkthrough-skip:hover { color: rgba(232,228,220,0.6); }
    .walkthrough-next {
      background: rgba(201,168,76,0.14);
      border: 1px solid rgba(201,168,76,0.22);
      border-radius: 8px;
      color: rgba(232,228,220,0.85);
      font-family: var(--sans);
      font-size: 0.78rem;
      font-weight: 500;
      padding: 8px 20px;
      cursor: pointer;
      transition: all 0.2s;
      letter-spacing: 0.01em;
    }
    .walkthrough-next:hover {
      background: rgba(201,168,76,0.22);
      color: #e8e4dc;
    }
    .walkthrough-dots {
      display: flex;
      gap: 6px;
    }
    .walkthrough-dots span {
      width: 6px;
      height: 6px;
      border-radius: 50%;
      background: rgba(232,228,220,0.15);
      transition: all 0.3s;
    }
    .walkthrough-dots span.active {
      background: rgba(201,168,76,0.7);
      width: 18px;
      border-radius: 3px;
    }

    .mobile-header { display: none; }

    /* --- Mobile top bar (ChatGPT-style) --- */
    .mobile-topbar {
      display: none;
      align-items: center;
      padding: 14px 18px;
      background: rgba(0,0,0,0.85);
      backdrop-filter: blur(16px);
      -webkit-backdrop-filter: blur(16px);
      border-bottom: 1px solid rgba(255,255,255,0.04);
      position: sticky;
      top: 0;
      z-index: 1000;
    }
    .mobile-topbar-book {
      background: none;
      border: none;
      color: rgba(232,228,220,0.7);
      cursor: pointer;
      padding: 6px;
      border-radius: 8px;
      transition: color 0.2s, background 0.2s;
    }
    .mobile-topbar-book:active {
      background: rgba(255,255,255,0.06);
      color: rgba(201,168,76,0.9);
    }
    .mobile-topbar-title {
      flex: 1;
      text-align: center;
      font-family: var(--font);
      font-size: 1.15rem;
      font-weight: 600;
      letter-spacing: -0.01em;
      color: rgba(232,228,220,0.85);
    }
    .mobile-topbar-spacer { width: 34px; }

    /* --- Mobile model label --- */
    .mobile-model-label {
      display: none;
      font-family: var(--sans);
      font-size: 0.75rem;
      color: rgba(232,228,220,0.35);
      letter-spacing: 0.03em;
      margin-bottom: 6px;
    }

    /* --- Mobile suggestion chips --- */
    .mobile-suggestions { display: none; }
    .mobile-chip {
      background: rgba(255,255,255,0.04);
      border: 1px solid rgba(255,255,255,0.08);
      border-radius: 16px;
      color: rgba(232,228,220,0.7);
      font-family: var(--sans);
      font-size: 0.85rem;
      padding: 10px 16px;
      cursor: pointer;
      transition: background 0.2s, border-color 0.2s;
      white-space: nowrap;
    }
    .mobile-chip:active {
      background: rgba(201,168,76,0.1);
      border-color: rgba(201,168,76,0.2);
    }

    /* --- Splash intro --- */
    .splash {
      position: fixed;
      inset: 0;
      z-index: 100000;
      background: #000;
      display: flex;
      align-items: center;
      justify-content: center;
      flex-direction: column;
      cursor: pointer;
      overflow: hidden;
    }
    .splash-glow {
      position: absolute;
      width: 380px;
      height: 380px;
      border-radius: 50%;
      background: radial-gradient(circle, rgba(201,168,76,0.13) 0%, rgba(160,120,40,0.04) 45%, transparent 70%);
      opacity: 0;
      animation: splGlowIn 2.2s ease-out 0.15s forwards;
      pointer-events: none;
    }
    @keyframes splGlowIn {
      0% { opacity: 0; transform: scale(0.4); }
      100% { opacity: 1; transform: scale(1); }
    }
    .splash-cross {
      width: 74px;
      height: auto;
      opacity: 0;
      animation: splCrossIn 1.3s ease-out 0.3s forwards;
      filter: drop-shadow(0 0 20px rgba(201,168,76,0.2));
      position: relative;
      z-index: 2;
    }
    @keyframes splCrossIn {
      0% { opacity: 0; transform: scale(0.8); filter: drop-shadow(0 0 15px rgba(201,168,76,0.05)); }
      100% { opacity: 1; transform: scale(1); filter: drop-shadow(0 0 25px rgba(201,168,76,0.3)); }
    }
    .splash-title {
      font-family: var(--font);
      font-size: 2.4rem;
      font-weight: 700;
      letter-spacing: -0.03em;
      color: transparent;
      background: linear-gradient(165deg, #f0d878 0%, #c9a84c 40%, #8a6d2e 100%);
      -webkit-background-clip: text;
      background-clip: text;
      margin-top: 22px;
      opacity: 0;
      animation: splTextIn 0.9s ease-out 1.1s forwards;
      position: relative;
      z-index: 2;
    }
    .splash-subtitle {
      font-family: var(--font);
      font-size: 0.78rem;
      font-weight: 300;
      color: rgba(232,228,220,0.4);
      letter-spacing: 0.06em;
      margin-top: 8px;
      opacity: 0;
      animation: splTextIn 0.8s ease-out 1.6s forwards;
      position: relative;
      z-index: 2;
    }
    @keyframes splTextIn {
      0% { opacity: 0; transform: translateY(10px); }
      100% { opacity: 1; transform: translateY(0); }
    }
    .splash-particles {
      position: absolute;
      top: 45%;
      left: 50%;
      width: 0;
      height: 0;
      z-index: 1;
      pointer-events: none;
    }
    .splash-particle {
      position: absolute;
      border-radius: 50%;
      background: rgba(201,168,76,0.7);
      box-shadow: 0 0 4px rgba(201,168,76,0.25);
      animation: splPart var(--d) ease-out var(--t) both;
    }
    @keyframes splPart {
      0% { opacity: 0; transform: translate(var(--sx), var(--sy)) scale(0); }
      12% { opacity: 0.6; transform: translate(var(--sx), var(--sy)) scale(1); }
      100% { opacity: 0; transform: translate(var(--ex), var(--ey)) scale(0.15); }
    }

    /* Transition out */
    .splash.out { pointer-events: none; }
    .splash.out .splash-cross {
      animation: splCrossOut 1.3s ease-in-out forwards !important;
    }
    @keyframes splCrossOut {
      0% { opacity: 1; transform: scale(1); filter: drop-shadow(0 0 25px rgba(201,168,76,0.3)); }
      35% { opacity: 1; transform: scale(1.06); filter: drop-shadow(0 0 50px rgba(201,168,76,0.55)); }
      100% { opacity: 0; transform: scale(0.08); filter: drop-shadow(0 0 90px rgba(201,168,76,1)); }
    }
    .splash.out .splash-glow {
      animation: splGlowOut 1.4s ease-in-out forwards !important;
    }
    @keyframes splGlowOut {
      0% { opacity: 1; transform: scale(1); }
      35% { opacity: 1; transform: scale(1.6); }
      100% { opacity: 0; transform: scale(3.5); }
    }
    .splash.out .splash-title,
    .splash.out .splash-subtitle {
      animation: splTextOut 0.7s ease-in forwards !important;
    }
    @keyframes splTextOut {
      0% { opacity: 1; transform: translateY(0); }
      100% { opacity: 0; transform: translateY(-18px); }
    }
    .splash.out::after {
      content: '';
      position: absolute;
      inset: 0;
      background: #000;
      animation: splBgOut 0.6s ease-in 0.8s forwards;
      opacity: 0;
      pointer-events: none;
    }
    @keyframes splBgOut {
      0% { opacity: 1; }
      100% { opacity: 0; }
    }
    .splash.out {
      animation: splFade 0.4s ease-in 1.1s forwards;
    }
    @keyframes splFade {
      0% { opacity: 1; }
      100% { opacity: 0; visibility: hidden; }
    }

    /* --- Hero header (overlays sphere) --- */
    .hero-header {
      position: absolute;
      top: 0; left: 0; right: 0;
      z-index: 20;
      text-align: center;
      padding: 2.5rem 2rem 0;
      pointer-events: none;
      background: linear-gradient(to bottom, rgba(0,0,0,0.7) 0%, rgba(0,0,0,0.25) 70%, transparent 100%);
    }
    .hero-header > * { pointer-events: auto; }
    .hero-header h1 {
      font-size: 2.2rem;
      font-weight: 700;
      letter-spacing: -0.03em;
      color: transparent;
      background: linear-gradient(165deg, #f0d878 0%, #c9a84c 40%, #8a6d2e 100%);
      -webkit-background-clip: text;
      background-clip: text;
      line-height: 1.1;
      margin: 0 0 0.3rem;
    }
    .hero-header .sub {
      font-size: 0.88rem;
      color: rgba(232,228,220,0.7);
      max-width: 520px;
      margin: 0 auto 0.6rem;
      line-height: 1.6;
      font-weight: 300;
    }
    .sphere-stats-float {
      position: absolute;
      top: 38%;
      left: 0;
      right: 0;
      z-index: 25;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 8px;
      font-size: 0.72rem;
      color: rgba(232,228,220,0.65);
      letter-spacing: 0.04em;
      pointer-events: none;
    }
    .sphere-stats-float b { color: rgba(201,168,76,0.85); font-family: var(--mono); }
    .sphere-stats-float > * { pointer-events: auto; }
    .stats-info-btn {
      width: 17px;
      height: 17px;
      border-radius: 50%;
      border: 1.5px solid rgba(232,228,220,0.2);
      background: none;
      color: rgba(232,228,220,0.35);
      font-family: var(--sans);
      font-size: 0.56rem;
      font-weight: 700;
      font-style: normal;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      transition: all 0.2s ease;
      padding: 0;
      line-height: 1;
    }
    .stats-info-btn:hover {
      color: rgba(232,228,220,0.7);
      border-color: rgba(232,228,220,0.3);
      background: rgba(232,228,220,0.04);
    }

    /* --- Left chat panel (ChatGPT-style) --- */
    .left-panel {
      position: absolute;
      top: 0; bottom: 0;
      left: calc(50vw - 720px);
      z-index: 10;
      width: 310px;
      display: flex;
      flex-direction: column;
      padding-top: 3%;
      padding-bottom: 3%;
      pointer-events: auto;
      opacity: 0;
      animation: fadeIn 1.2s ease 0.6s forwards;
    }
    .chat-panel {
      display: flex;
      flex-direction: column;
      background: rgba(6,6,12,0.82);
      border: 1px solid rgba(201,168,76,0.07);
      border-radius: 10px;
      backdrop-filter: blur(14px);
      max-height: 80vh;
      overflow: hidden;
      transition: max-height 0.3s ease;
    }
    .chat-header {
      padding: 10px 14px 8px;
      border-bottom: 1px solid rgba(201,168,76,0.06);
      flex-shrink: 0;
    }
    .chat-header h4 {
      font-size: 0.66rem;
      text-transform: uppercase;
      letter-spacing: 0.14em;
      color: rgba(201,168,76,0.8);
      font-weight: 600;
      margin: 0 0 8px;
    }
    .search-mode-toggle {
      display: flex;
      background: rgba(255,255,255,0.04);
      border-radius: 10px;
      padding: 3px;
    }
    .search-mode-toggle button {
      flex: 1;
      background: none;
      border: none;
      color: rgba(232,228,220,0.4);
      font-size: 0.68rem;
      font-weight: 500;
      letter-spacing: 0.02em;
      padding: 8px 0;
      cursor: pointer;
      border-radius: 8px;
      transition: color 0.2s, background 0.2s;
    }
    .search-mode-toggle button.active {
      background: rgba(201,168,76,0.13);
      color: rgba(232,228,220,0.92);
    }
    .search-mode-toggle button:hover:not(.active) {
      color: rgba(232,228,220,0.6);
    }
    /* Collapsible book filter */
    .search-filter { margin-top: 10px; }
    .sf-header {
      display: flex;
      align-items: center;
      gap: 6px;
      cursor: pointer;
      font-size: 0.6rem;
      color: rgba(232,228,220,0.45);
      user-select: none;
      transition: color 0.15s;
    }
    .sf-header:hover { color: rgba(232,228,220,0.7); }
    .sf-badge {
      font-size: 0.5rem;
      color: rgba(201,168,76,0.7);
      margin-left: 2px;
    }
    .sf-chevron {
      margin-left: auto;
      color: rgba(232,228,220,0.3);
      transition: transform 0.2s;
    }
    .search-filter.open .sf-chevron { transform: rotate(180deg); }
    .sf-body {
      max-height: 0;
      overflow: hidden;
      transition: max-height 0.25s ease;
    }
    .search-filter.open .sf-body { max-height: 500px; }
    .sf-testament { margin-top: 8px; }
    .sf-testament-header {
      display: flex;
      align-items: center;
      gap: 6px;
      cursor: pointer;
      padding: 4px 0;
      user-select: none;
    }
    .sf-testament-header .sf-toggle-track { margin-left: auto; }
    .sf-testament-header span:first-child {
      font-size: 0.58rem;
      font-weight: 600;
      color: rgba(232,228,220,0.6);
      letter-spacing: 0.03em;
    }
    .sf-testament-header .sf-t-chevron {
      color: rgba(232,228,220,0.3);
      transition: transform 0.2s;
      flex-shrink: 0;
    }
    .sf-testament.open .sf-testament-header .sf-t-chevron {
      transform: rotate(180deg);
    }
    .sf-toggle-track {
      position: relative;
      width: 26px; height: 14px;
      background: rgba(255,255,255,0.08);
      border-radius: 7px;
      flex-shrink: 0;
      cursor: pointer;
      transition: background 0.2s;
    }
    .sf-toggle-track input { display: none; }
    .sf-toggle-track::after {
      content: '';
      position: absolute;
      top: 2px; left: 2px;
      width: 10px; height: 10px;
      border-radius: 50%;
      background: rgba(232,228,220,0.3);
      transition: transform 0.2s, background 0.2s;
    }
    .sf-toggle-track.on { background: rgba(201,168,76,0.3); }
    .sf-toggle-track.on::after {
      transform: translateX(12px);
      background: rgba(201,168,76,0.85);
    }
    .sf-book-list {
      max-height: 0;
      overflow: hidden;
      transition: max-height 0.2s ease;
      padding-left: 4px;
    }
    .sf-testament.open .sf-book-list { max-height: 800px; }
    .sf-book {
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 2px 0;
      cursor: pointer;
      user-select: none;
    }
    .sf-book span {
      font-size: 0.54rem;
      color: rgba(232,228,220,0.45);
      transition: color 0.12s;
    }
    .sf-book:hover span { color: rgba(232,228,220,0.7); }
    .sf-book.off span { color: rgba(232,228,220,0.15); }
    .sf-book .sf-toggle-track { width: 22px; height: 12px; border-radius: 6px; }
    .sf-book .sf-toggle-track::after { width: 8px; height: 8px; top: 2px; left: 2px; }
    .sf-book .sf-toggle-track.on::after { transform: translateX(10px); }

    /* Chat messages area */
    .chat-messages {
      flex: 1;
      overflow-y: auto;
      padding: 14px 18px;
      scrollbar-width: thin;
      scrollbar-color: rgba(201,168,76,0.1) transparent;
    }
    .chat-empty {
      text-align: center;
      padding: 40px 10px;
      color: rgba(232,228,220,0.7);
      font-size: 0.72rem;
      line-height: 1.7;
    }
    .chat-empty .chat-icon {
      font-size: 1.6rem;
      margin-bottom: 10px;
      opacity: 0.3;
    }
    #search-results-desc {
      font-size: 0.58rem;
      color: rgba(232,228,220,0.5);
      margin-bottom: 8px;
      line-height: 1.5;
    }

    /* Result items as chat bubbles */
    .sr-item {
      background: rgba(201,168,76,0.04);
      border: 1px solid rgba(201,168,76,0.06);
      border-radius: 10px;
      padding: 10px 14px;
      margin-bottom: 8px;
      cursor: pointer;
      transition: border-color 0.15s, background 0.15s;
      animation: srItemIn 0.4s ease both;
    }
    .sr-item:hover {
      border-color: rgba(201,168,76,0.15);
      background: rgba(201,168,76,0.07);
    }
    .sr-item.active {
      border-color: rgba(201,168,76,0.3);
      background: rgba(201,168,76,0.1);
    }
    .sr-ref {
      color: #c9a84c;
      font-weight: 600;
      font-size: 0.7rem;
    }
    .sr-score {
      float: right;
      font-family: var(--mono);
      font-size: 0.56rem;
      color: rgba(201,168,76,0.4);
    }
    .sr-text {
      color: rgba(232,228,220,0.4);
      display: block;
      margin-top: 4px;
      font-size: 0.72rem;
      line-height: 1.55;
    }
    .sr-title {
      color: rgba(232,228,220,0.65);
      font-weight: 600;
      font-size: 0.68rem;
      display: block;
      margin-top: 2px;
    }
    .sr-passage-text {
      color: rgba(232,228,220,0.3);
      display: block;
      margin-top: 4px;
      font-size: 0.64rem;
      line-height: 1.55;
      max-height: 3.2em;
      overflow: hidden;
    }
    .sr-bar {
      height: 2px;
      background: rgba(255,255,255,0.04);
      border-radius: 1px;
      margin-top: 6px;
    }
    .sr-bar-fill {
      height: 100%;
      background: rgba(201,168,76,0.3);
      border-radius: 1px;
    }

    /* Chat input area (bottom, like ChatGPT) */
    .chat-input-area {
      padding: 12px 14px;
      border-top: 1px solid rgba(201,168,76,0.06);
      flex-shrink: 0;
    }
    .chat-input-wrap {
      position: relative;
      display: flex;
      align-items: center;
    }
    #verse-search {
      width: 100%;
      background: rgba(12,12,20,0.9);
      border: 1px solid rgba(201,168,76,0.1);
      border-radius: 22px;
      color: #e8e4dc;
      font-family: var(--font);
      font-size: 0.78rem;
      padding: 10px 72px 10px 16px;
      outline: none;
      transition: border-color 0.2s;
    }
    #verse-search::placeholder { color: rgba(232,228,220,0.5); }
    #verse-search:focus { border-color: rgba(201,168,76,0.35); }
    .chat-clear-btn {
      position: absolute;
      right: 40px;
      background: none;
      border: none;
      color: rgba(232,228,220,0.25);
      font-size: 0.8rem;
      cursor: pointer;
      padding: 4px;
      line-height: 1;
    }
    .chat-clear-btn:hover { color: #e8e4dc; }
    .chat-send-btn {
      position: absolute;
      right: 6px;
      width: 30px;
      height: 30px;
      border-radius: 50%;
      border: none;
      background: rgba(201,168,76,0.8);
      color: #0a0a14;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      transition: background 0.15s, opacity 0.15s;
      opacity: 0.5;
    }
    .chat-send-btn:hover { background: #c9a84c; opacity: 1; }
    .chat-send-btn.ready { opacity: 1; }
    #search-status {
      display: none;
      text-align: center;
      font-size: 0.62rem;
      font-family: var(--mono);
      color: rgba(201,168,76,0.5);
      padding: 8px 0 0;
      letter-spacing: 0.06em;
    }
    #search-status .search-dot {
      display: inline-block;
      width: 5px; height: 5px;
      background: rgba(201,168,76,0.6);
      border-radius: 50%;
      margin-right: 6px;
      animation: searchPulse 1.2s ease-in-out infinite;
    }
    @keyframes searchPulse {
      0%, 100% { opacity: 0.3; } 50% { opacity: 1; }
    }

    /* --- Passage modal --- */
    .passage-modal-overlay {
      display: none;
      position: fixed;
      inset: 0;
      z-index: 9999;
      background: rgba(0,0,0,0.75);
      backdrop-filter: blur(8px);
      justify-content: center;
      align-items: center;
    }
    .passage-modal-overlay.open { display: flex; }
    .passage-modal {
      background: rgba(10,10,18,0.96);
      border: 1px solid rgba(201,168,76,0.12);
      border-radius: 14px;
      max-width: 620px;
      width: 90vw;
      max-height: 80vh;
      overflow-y: auto;
      padding: 32px 36px;
      position: relative;
      box-shadow: 0 24px 80px rgba(0,0,0,0.6);
      scrollbar-width: thin;
      scrollbar-color: rgba(201,168,76,0.12) transparent;
    }
    .passage-modal-close {
      position: absolute;
      top: 14px; right: 18px;
      background: none; border: none;
      color: rgba(232,228,220,0.3);
      font-size: 1.2rem;
      cursor: pointer;
      transition: color 0.15s;
    }
    .passage-modal-close:hover { color: #e8e4dc; }
    .passage-modal-ref {
      font-family: var(--mono);
      font-size: 0.72rem;
      color: #c9a84c;
      letter-spacing: 0.04em;
      margin-bottom: 4px;
    }
    .passage-modal-title {
      font-size: 1.1rem;
      font-weight: 700;
      color: #e8e4dc;
      line-height: 1.35;
      margin-bottom: 20px;
    }
    .passage-modal-body {
      font-size: 0.88rem;
      line-height: 1.85;
      color: rgba(232,228,220,0.7);
    }
    .passage-modal-body .pm-verse-num {
      font-family: var(--mono);
      font-size: 0.6rem;
      color: rgba(201,168,76,0.35);
      vertical-align: super;
      margin-right: 2px;
    }
    .pm-translation-toggle {
      display: flex;
      gap: 0;
      margin-bottom: 18px;
    }
    .pm-translation-toggle button {
      flex: 1;
      background: rgba(12,12,20,0.6);
      border: 1px solid rgba(201,168,76,0.08);
      color: rgba(232,228,220,0.3);
      font-family: var(--mono);
      font-size: 0.62rem;
      letter-spacing: 0.06em;
      padding: 8px 0;
      cursor: pointer;
      transition: all 0.18s;
    }
    .pm-translation-toggle button:first-child { border-radius: 6px 0 0 6px; border-right: none; }
    .pm-translation-toggle button:last-child { border-radius: 0 6px 6px 0; }
    .pm-translation-toggle button.active {
      background: rgba(201,168,76,0.12);
      border-color: rgba(201,168,76,0.25);
      color: #c9a84c;
    }
    .pm-translation-toggle button:hover:not(.active) {
      border-color: rgba(201,168,76,0.15);
      color: rgba(232,228,220,0.5);
    }
    .pm-read-context {
      display: flex;
      align-items: center;
      gap: 6px;
      margin-top: 18px;
      padding: 9px 16px;
      background: rgba(201,168,76,0.06);
      border: 1px solid rgba(201,168,76,0.12);
      border-radius: 8px;
      color: rgba(201,168,76,0.7);
      font-family: var(--mono);
      font-size: 0.62rem;
      letter-spacing: 0.05em;
      cursor: pointer;
      transition: all 0.18s;
      width: fit-content;
    }
    .pm-read-context:hover {
      background: rgba(201,168,76,0.12);
      border-color: rgba(201,168,76,0.25);
      color: #c9a84c;
    }
    .pm-read-context svg { width: 13px; height: 13px; opacity: 0.7; }
    .pm-read-context:hover svg { opacity: 1; }

    /* --- Reader transition --- */
    .reader-transition {
      position: fixed;
      inset: 0;
      z-index: 9999;
      background: #000;
      display: flex;
      align-items: center;
      justify-content: center;
      flex-direction: column;
      opacity: 0;
      pointer-events: none;
    }
    .reader-transition.active {
      pointer-events: auto;
      animation: rtFadeIn 0.7s ease forwards;
    }
    @keyframes rtFadeIn {
      0% { opacity: 0; }
      100% { opacity: 1; }
    }
    .rt-bible {
      position: relative;
      width: 150px;
      height: 200px;
      perspective: 1200px;
    }
    .rt-book {
      position: absolute;
      inset: 0;
      transform-style: preserve-3d;
    }
    .rt-spine {
      position: absolute;
      left: 0; top: 0;
      width: 100%; height: 100%;
      border-radius: 4px;
      background: linear-gradient(160deg, #3a2a14 0%, #2a1c0d 50%, #1e1408 100%);
      border: 1.5px solid rgba(201,168,76,0.22);
      box-shadow:
        inset 0 0 30px rgba(201,168,76,0.04),
        0 4px 40px rgba(0,0,0,0.6);
    }
    .rt-spine-decor {
      position: absolute;
      top: 50%; left: 50%;
      transform: translate(-50%, -50%);
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 10px;
    }
    .rt-cross-icon { width: 26px; height: 26px; opacity: 0.65; }
    .rt-label {
      font-family: var(--font);
      font-size: 0.6rem; font-weight: 600;
      letter-spacing: 0.12em; text-transform: uppercase;
      color: rgba(201,168,76,0.5); text-align: center;
    }
    .rt-label-sub {
      font-family: var(--font);
      font-size: 0.4rem; font-weight: 300;
      letter-spacing: 0.08em;
      color: rgba(201,168,76,0.25); margin-top: -6px;
    }
    .rt-line {
      width: 30px; height: 1px;
      background: linear-gradient(90deg, transparent, rgba(201,168,76,0.25), transparent);
    }
    .rt-cover {
      position: absolute;
      top: 0; left: 0; width: 100%; height: 100%;
      border-radius: 4px;
      background: linear-gradient(160deg, #3a2a14 0%, #2a1c0d 50%, #1e1408 100%);
      border: 1.5px solid rgba(201,168,76,0.22);
      transform-origin: left center;
      backface-visibility: hidden;
      z-index: 3;
      box-shadow:
        inset 0 0 30px rgba(201,168,76,0.04),
        0 4px 40px rgba(0,0,0,0.6);
    }
    .rt-cover-inner {
      position: absolute; inset: 0;
      display: flex; align-items: center; justify-content: center;
    }
    .rt-glow {
      position: absolute;
      width: 280px; height: 280px;
      top: 50%; left: 50%;
      transform: translate(-50%, -50%);
      border-radius: 50%;
      background: radial-gradient(circle, rgba(201,168,76,0.07) 0%, transparent 70%);
      pointer-events: none;
    }

    /* Phase 1: Bible appears gently */
    .reader-transition.phase-1 .rt-bible {
      animation: rtAppear 0.9s cubic-bezier(0.16, 1, 0.3, 1) forwards;
    }
    @keyframes rtAppear {
      0% { opacity: 0; transform: scale(0.88); }
      100% { opacity: 1; transform: scale(1); }
    }

    /* Phase 2: Slow, smooth crossfade to reader */
    .reader-transition.phase-2 {
      animation: rtFadeOut 1.2s cubic-bezier(0.4, 0, 0.2, 1) forwards;
    }
    @keyframes rtFadeOut {
      0% { opacity: 1; }
      100% { opacity: 0; }
    }

    /* --- Reader overlay --- */
    .reader-overlay {
      display: none;
      position: fixed;
      inset: 0;
      z-index: 9998;
      background: rgba(6,6,12,0.98);
      flex-direction: column;
      opacity: 0;
      transition: opacity 0.8s ease;
    }
    .reader-overlay.open { display: flex; }
    .reader-overlay.visible { opacity: 1; }
    .reader-topbar {
      position: relative;
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 18px 28px 16px;
      border-bottom: 1px solid rgba(232,228,220,0.04);
      flex-shrink: 0;
      background: rgba(6,6,12,0.98);
    }
    .reader-topbar-left {
      position: absolute;
      left: 20px;
      top: 50%;
      transform: translateY(-50%);
      display: flex;
      align-items: center;
      gap: 8px;
    }
    .reader-close {
      background: none;
      border: 1px solid rgba(232,228,220,0.06);
      border-radius: 8px;
      color: rgba(232,228,220,0.3);
      font-size: 0.92rem;
      cursor: pointer;
      transition: all 0.2s;
      flex-shrink: 0;
      width: 32px;
      height: 32px;
      display: flex;
      align-items: center;
      justify-content: center;
    }
    .reader-close:hover {
      color: rgba(232,228,220,0.7);
      border-color: rgba(232,228,220,0.12);
      background: rgba(232,228,220,0.03);
    }
    .reader-topbar-center {
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 6px;
    }
    .reader-topbar-title {
      display: flex;
      align-items: center;
      gap: 24px;
    }
    .reader-topbar-title .cd-trigger {
      font-size: 1.3rem;
      font-weight: 700;
      letter-spacing: -0.02em;
      color: rgba(232,228,220,0.88);
      padding: 4px 2px;
    }
    .reader-topbar-title .cd-trigger:hover {
      color: #e8e4dc;
    }
    .reader-topbar-title .cd-trigger .cd-chev {
      width: 9px;
      height: 6px;
      opacity: 0.25;
    }
    .reader-topbar-title .rt-dot {
      width: 3px;
      height: 3px;
      border-radius: 50%;
      background: rgba(201,168,76,0.3);
      flex-shrink: 0;
    }
    .reader-chapter-nav {
      display: flex;
      align-items: center;
      gap: 4px;
      flex-shrink: 0;
    }
    .reader-chapter-nav > button {
      background: none;
      border: none;
      color: rgba(232,228,220,0.25);
      border-radius: 6px;
      width: 26px;
      height: 26px;
      cursor: pointer;
      font-size: 1rem;
      display: flex;
      align-items: center;
      justify-content: center;
      transition: all 0.15s;
      flex-shrink: 0;
    }
    .reader-chapter-nav > button:hover {
      background: rgba(232,228,220,0.04);
      color: rgba(232,228,220,0.65);
    }
    .reader-chapter-nav > button:disabled {
      opacity: 0.12;
      cursor: default;
      background: none;
    }
    .reader-chapter-nav .cd-trigger {
      font-size: 0.88rem;
      font-weight: 500;
      color: rgba(232,228,220,0.45);
      letter-spacing: 0.02em;
    }
    /* Custom dropdown */
    .cd-wrap {
      position: relative;
      display: inline-block;
    }
    .cd-trigger {
      display: flex;
      align-items: center;
      gap: 6px;
      background: none;
      border: none;
      color: rgba(232,228,220,0.7);
      font-family: var(--sans);
      font-size: 0.75rem;
      font-weight: 500;
      letter-spacing: 0.01em;
      padding: 6px 2px;
      cursor: pointer;
      transition: color 0.15s;
      white-space: nowrap;
    }
    .cd-trigger:hover { color: rgba(232,228,220,0.95); }
    .cd-trigger .cd-chev {
      width: 8px; height: 5px;
      opacity: 0.3;
      transition: opacity 0.15s, transform 0.2s;
      flex-shrink: 0;
    }
    .cd-wrap.open .cd-chev { transform: rotate(180deg); opacity: 0.5; }
    .cd-menu {
      display: none;
      position: absolute;
      top: calc(100% + 4px);
      left: 0;
      min-width: 100%;
      max-height: 320px;
      overflow-y: auto;
      background: rgba(14,14,22,0.98);
      border: 1px solid rgba(232,228,220,0.06);
      border-radius: 10px;
      padding: 4px;
      z-index: 100;
      backdrop-filter: blur(20px);
      box-shadow: 0 8px 32px rgba(0,0,0,0.5);
      scrollbar-width: thin;
      scrollbar-color: rgba(232,228,220,0.06) transparent;
    }
    .cd-wrap.open .cd-menu { display: block; }
    .cd-item {
      display: flex;
      align-items: center;
      gap: 8px;
      padding: 7px 12px;
      border-radius: 7px;
      font-family: var(--sans);
      font-size: 0.72rem;
      color: rgba(232,228,220,0.55);
      cursor: pointer;
      transition: background 0.12s, color 0.12s;
      white-space: nowrap;
    }
    .cd-item:hover {
      background: rgba(232,228,220,0.05);
      color: rgba(232,228,220,0.85);
    }
    .cd-item.active {
      color: rgba(201,168,76,0.9);
    }
    .cd-item .cd-check {
      width: 14px;
      height: 14px;
      display: flex;
      align-items: center;
      justify-content: center;
      flex-shrink: 0;
    }
    .cd-item .cd-check svg {
      width: 10px; height: 10px;
      opacity: 0;
      transition: opacity 0.1s;
    }
    .cd-item.active .cd-check svg { opacity: 1; }
    .cd-menu-search {
      padding: 6px 8px;
      margin-bottom: 2px;
    }
    .cd-menu-search input {
      width: 100%;
      background: rgba(232,228,220,0.03);
      border: 1px solid rgba(232,228,220,0.06);
      border-radius: 6px;
      color: rgba(232,228,220,0.8);
      font-family: var(--sans);
      font-size: 0.68rem;
      padding: 6px 10px;
      outline: none;
      transition: border-color 0.15s;
    }
    .cd-menu-search input:focus {
      border-color: rgba(201,168,76,0.2);
    }
    .cd-menu-search input::placeholder {
      color: rgba(232,228,220,0.2);
    }
    .cd-divider {
      height: 1px;
      background: rgba(232,228,220,0.04);
      margin: 4px 8px;
    }
    .cd-group-label {
      font-size: 0.56rem;
      font-weight: 600;
      color: rgba(201,168,76,0.4);
      letter-spacing: 0.1em;
      text-transform: uppercase;
      padding: 8px 12px 4px;
    }
    .reader-topbar-right {
      position: absolute;
      right: 20px;
      top: 50%;
      transform: translateY(-50%);
      display: flex;
      align-items: center;
      gap: 10px;
    }
    .reader-tl-wrap {
      display: flex;
      align-items: center;
      gap: 8px;
    }
    .reader-tl-label {
      font-family: var(--sans);
      font-size: 0.65rem;
      font-weight: 500;
      letter-spacing: 0.06em;
      text-transform: uppercase;
      color: rgba(232,228,220,0.4);
    }
    .reader-tl-toggle {
      display: flex;
      gap: 3px;
      background: rgba(232,228,220,0.02);
      border: 1px solid rgba(232,228,220,0.04);
      border-radius: 8px;
      padding: 2px;
    }
    .reader-tl-toggle button {
      background: none;
      border: none;
      color: rgba(232,228,220,0.4);
      font-family: var(--sans);
      font-size: 0.72rem;
      font-weight: 500;
      letter-spacing: 0.01em;
      padding: 5px 10px;
      cursor: pointer;
      transition: all 0.2s;
      white-space: nowrap;
      border-radius: 6px;
    }
    .reader-tl-toggle button:hover:not(.active) {
      color: rgba(232,228,220,0.6);
    }
    .reader-tl-toggle button.active {
      background: rgba(232,228,220,0.08);
      color: rgba(232,228,220,0.9);
    }
    .reader-content {
      position: absolute;
      top: 0;
      left: 0;
      right: 370px;
      bottom: 0;
      overflow-y: auto;
      padding: 40px 20px 80px;
      scrollbar-width: auto;
      scrollbar-color: rgba(232,228,220,0.15) transparent;
    }
    .reader-content::-webkit-scrollbar { width: 8px; }
    .reader-content::-webkit-scrollbar-track { background: transparent; }
    .reader-content::-webkit-scrollbar-thumb {
      background: rgba(232,228,220,0.12);
      border-radius: 4px;
    }
    .reader-content::-webkit-scrollbar-thumb:hover {
      background: rgba(232,228,220,0.25);
    }
    .reader-inner {
      width: 100%;
      max-width: 660px;
      margin-left: auto;
      margin-right: auto;
      transform: translateX(185px);
    }
    .reader-chapter-heading {
      font-family: var(--sans);
      font-size: 0.85rem;
      font-weight: 600;
      color: rgba(201,168,76,0.45);
      letter-spacing: 0.12em;
      text-transform: uppercase;
      margin: 48px 0 20px;
      padding-bottom: 10px;
      border-bottom: 1px solid rgba(201,168,76,0.06);
    }
    .reader-chapter-heading:first-child { margin-top: 0; }
    .reader-verse {
      display: inline;
    }
    .reader-verse-num {
      font-family: var(--mono);
      font-size: 0.55rem;
      color: rgba(201,168,76,0.3);
      vertical-align: super;
      margin-right: 2px;
      margin-left: 4px;
      line-height: 0;
    }
    .reader-verse-text {
      font-size: 0.92rem;
      line-height: 2;
      color: rgba(232,228,220,0.7);
    }
    .reader-verse.highlight .reader-verse-text {
      color: rgba(232,228,220,0.95);
      background: rgba(201,168,76,0.08);
      box-shadow: 0 0 0 3px rgba(201,168,76,0.08);
      border-radius: 3px;
    }
    .reader-verse.highlight .reader-verse-num {
      color: rgba(201,168,76,0.7);
    }

    /* --- Reader selection tooltip --- */
    .reader-sel-tooltip {
      position: absolute;
      z-index: 1000;
      pointer-events: none;
      opacity: 0;
      transform: translateY(4px) scale(0.96);
      transition: opacity 0.18s ease, transform 0.18s ease;
    }
    .reader-sel-tooltip.visible {
      pointer-events: auto;
      opacity: 1;
      transform: translateY(0) scale(1);
    }
    .reader-sel-tooltip button {
      display: flex;
      align-items: center;
      gap: 6px;
      padding: 7px 14px;
      border: 1px solid rgba(201,168,76,0.18);
      border-radius: 10px;
      background: rgba(18,16,22,0.88);
      backdrop-filter: blur(16px);
      -webkit-backdrop-filter: blur(16px);
      color: rgba(232,228,220,0.85);
      font-family: var(--sans);
      font-size: 0.72rem;
      font-weight: 500;
      letter-spacing: 0.01em;
      cursor: pointer;
      white-space: nowrap;
      box-shadow: 0 4px 20px rgba(0,0,0,0.45), 0 0 0 0.5px rgba(201,168,76,0.08);
      transition: all 0.15s ease;
    }
    .reader-sel-tooltip button:hover {
      background: rgba(28,24,36,0.92);
      border-color: rgba(201,168,76,0.32);
      color: rgba(232,228,220,0.95);
      box-shadow: 0 4px 24px rgba(0,0,0,0.5), 0 0 0 0.5px rgba(201,168,76,0.15);
    }
    .reader-sel-tooltip button svg {
      opacity: 0.7;
      color: rgba(201,168,76,0.8);
    }

    /* --- Reader chat panel --- */
    .reader-body {
      position: relative;
      display: flex;
      flex: 1;
      min-height: 0;
      overflow: hidden;
    }
    .reader-chat {
      width: 370px;
      min-width: 370px;
      display: flex;
      flex-direction: column;
      background: rgba(8,8,14,0.95);
      border-left: 1px solid rgba(201,168,76,0.06);
      flex-shrink: 0;
      position: relative;
      z-index: 2;
      margin-left: auto;
    }
    .reader-chat-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 10px 16px;
      border-bottom: 1px solid rgba(232,228,220,0.04);
      flex-shrink: 0;
      min-width: 370px;
    }
    .reader-chat-header span {
      font-size: 0.65rem;
      font-weight: 600;
      color: rgba(232,228,220,0.45);
      letter-spacing: 0.04em;
      white-space: nowrap;
    }
    .reader-chat-header button {
      background: none;
      border: none;
      color: rgba(232,228,220,0.18);
      cursor: pointer;
      padding: 2px;
      transition: color 0.15s;
    }
    .reader-chat-header button:hover { color: rgba(232,228,220,0.5); }
    .reader-chat-header button svg { width: 13px; height: 13px; }
    .reader-chat-header .cd-trigger {
      font-size: 0.95rem;
      color: rgba(232,228,220,0.45);
    }
    .reader-chat-header .cd-menu {
      min-width: 180px;
    }
    .reader-chat-model-loading {
      display: none;
      position: absolute;
      inset: 0;
      z-index: 20;
      background: rgba(8,8,14,0.97);
      align-items: center;
      justify-content: center;
      flex-direction: column;
    }
    .reader-chat-model-loading.active {
      display: flex;
    }
    .rcml-inner {
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 0;
      width: 100%;
    }
    .rcml-dots {
      display: flex;
      gap: 6px;
      margin-bottom: 20px;
    }
    .rcml-dots span {
      width: 5px;
      height: 5px;
      border-radius: 50%;
      background: rgba(201,168,76,0.5);
      animation: rcmlPulse 1.4s ease-in-out infinite;
    }
    .rcml-dots span:nth-child(2) { animation-delay: 0.2s; }
    .rcml-dots span:nth-child(3) { animation-delay: 0.4s; }
    @keyframes rcmlPulse {
      0%, 80%, 100% { opacity: 0.25; transform: scale(0.85); }
      40% { opacity: 1; transform: scale(1); }
    }
    .rcml-text {
      font-family: var(--sans);
      font-size: 0.72rem;
      font-weight: 500;
      color: rgba(232,228,220,0.6);
      letter-spacing: 0.01em;
      text-align: center;
      margin-bottom: 20px;
    }
    .rcml-bar-wrap {
      width: 60%;
      max-width: 200px;
      height: 2px;
      background: rgba(232,228,220,0.04);
      border-radius: 1px;
      overflow: hidden;
      margin-bottom: 16px;
    }
    .rcml-bar {
      height: 100%;
      width: 0%;
      background: rgba(201,168,76,0.6);
      border-radius: 1px;
      transition: width 0.4s ease;
    }
    .rcml-sub {
      font-family: var(--sans);
      font-size: 0.72rem;
      color: rgba(232,228,220,0.45);
      letter-spacing: 0.01em;
      text-align: center;
      max-width: 340px;
      line-height: 1.65;
    }
    .reader-chat-settings {
      padding: 12px 16px 14px;
      border-bottom: 1px solid rgba(201,168,76,0.04);
      min-width: 370px;
    }
    .reader-chat-settings.highlight {
      animation: settingsPulse 0.6s ease;
    }
    @keyframes settingsPulse {
      0%, 100% { background: transparent; }
      40% { background: rgba(201,168,76,0.04); }
    }
    .reader-chat-settings-msg {
      font-size: 0.62rem;
      color: rgba(232,228,220,0.4);
      line-height: 1.65;
      margin-bottom: 10px;
    }
    .reader-chat-settings-msg a {
      color: rgba(201,168,76,0.55);
      text-decoration: none;
      transition: color 0.15s;
    }
    .reader-chat-settings-msg a:hover { color: #c9a84c; }
    .reader-chat-key-wrap {
      display: flex;
      gap: 6px;
    }
    .reader-chat-key-wrap input {
      flex: 1;
      background: rgba(12,12,20,0.6);
      border: 1px solid rgba(201,168,76,0.06);
      border-radius: 5px;
      color: rgba(232,228,220,0.5);
      font-family: var(--mono);
      font-size: 0.56rem;
      padding: 6px 9px;
      outline: none;
    }
    .reader-chat-key-wrap input:focus { border-color: rgba(201,168,76,0.18); }
    .reader-chat-key-wrap button {
      background: rgba(201,168,76,0.08);
      border: 1px solid rgba(201,168,76,0.1);
      border-radius: 5px;
      color: rgba(232,228,220,0.35);
      font-size: 0.52rem;
      padding: 4px 10px;
      cursor: pointer;
      white-space: nowrap;
      transition: all 0.15s;
    }
    .reader-chat-key-wrap button:hover {
      background: rgba(201,168,76,0.14);
      color: rgba(232,228,220,0.6);
    }
    .reader-chat-settings-hint {
      font-size: 0.5rem;
      color: rgba(232,228,220,0.13);
      margin-top: 6px;
      line-height: 1.5;
    }
    .reader-chat-messages {
      flex: 1;
      overflow-y: auto;
      padding: 16px;
      min-width: 370px;
      scrollbar-width: thin;
      scrollbar-color: rgba(201,168,76,0.05) transparent;
    }
    .reader-chat-empty {
      color: rgba(232,228,220,0.4);
      font-size: 0.88rem;
      text-align: center;
      margin-top: 40%;
      line-height: 1.8;
      padding: 0 24px;
    }
    .chat-msg {
      margin-bottom: 14px;
      max-width: 92%;
    }
    .chat-msg-user { margin-left: auto; text-align: right; }
    .chat-msg-user .chat-bubble {
      background: rgba(201,168,76,0.08);
      border: 1px solid rgba(201,168,76,0.1);
      border-radius: 12px 12px 2px 12px;
      padding: 9px 13px;
      display: inline-block;
      text-align: left;
    }
    .chat-msg-assistant .chat-bubble {
      background: rgba(232,228,220,0.02);
      border: 1px solid rgba(232,228,220,0.04);
      border-radius: 12px 12px 12px 2px;
      padding: 9px 13px;
      display: inline-block;
    }
    .chat-bubble {
      font-size: 0.76rem;
      line-height: 1.75;
      color: rgba(232,228,220,0.65);
    }
    .chat-msg-user .chat-bubble { color: rgba(232,228,220,0.75); }
    .chat-msg-label {
      font-size: 0.52rem;
      color: rgba(232,228,220,0.55);
      margin-bottom: 3px;
      font-weight: 500;
      letter-spacing: 0.04em;
    }
    .chat-bubble strong { color: rgba(232,228,220,0.85); font-weight: 600; }
    .chat-bubble em { color: rgba(201,168,76,0.6); font-style: italic; }
    .chat-typing-dots { display: flex; gap: 4px; padding: 4px 0; }
    .chat-typing-dots span {
      width: 5px; height: 5px; border-radius: 50%;
      background: rgba(201,168,76,0.5);
      animation: rcmlPulse 1.4s ease-in-out infinite;
    }
    .chat-typing-dots span:nth-child(2) { animation-delay: 0.2s; }
    .chat-typing-dots span:nth-child(3) { animation-delay: 0.4s; }
    .reader-chat-input-wrap {
      display: flex;
      gap: 8px;
      padding: 11px 16px;
      border-top: 1px solid rgba(201,168,76,0.05);
      flex-shrink: 0;
      align-items: flex-end;
      min-width: 370px;
    }
    .reader-chat-input-wrap textarea {
      flex: 1;
      background: rgba(12,12,20,0.5);
      border: 1px solid rgba(201,168,76,0.06);
      border-radius: 8px;
      color: rgba(232,228,220,0.65);
      font-family: var(--font);
      font-size: 0.88rem;
      padding: 11px 14px;
      outline: none;
      resize: none;
      max-height: 96px;
      line-height: 1.5;
      scrollbar-width: thin;
      scrollbar-color: rgba(201,168,76,0.05) transparent;
    }
    .reader-chat-input-wrap textarea:focus { border-color: rgba(201,168,76,0.18); }
    .reader-chat-input-wrap textarea::placeholder { color: rgba(232,228,220,0.35); }
    .reader-chat-input-wrap button {
      background: rgba(201,168,76,0.1);
      border: 1px solid rgba(201,168,76,0.12);
      border-radius: 8px;
      color: rgba(201,168,76,0.6);
      width: 34px;
      height: 34px;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      flex-shrink: 0;
      transition: all 0.15s;
    }
    .reader-chat-input-wrap button:hover {
      background: rgba(201,168,76,0.18);
      color: #c9a84c;
    }
    .reader-chat-input-wrap button svg { width: 14px; height: 14px; }
    .reader-chat-disclaimer {
      padding: 0 16px 10px;
      font-size: 0.68rem;
      color: rgba(232,228,220,0.3);
      text-align: center;
      letter-spacing: 0.02em;
      line-height: 1.6;
      min-width: 370px;
      flex-shrink: 0;
    }

    /* --- Reader model picker --- */
    .reader-model-picker {
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      flex: 1;
      padding: 32px 20px;
      animation: rmpFadeIn 0.4s ease both;
    }
    @keyframes rmpFadeIn {
      from { opacity: 0; transform: translateY(8px); }
      to { opacity: 1; transform: translateY(0); }
    }
    .rmp-label {
      font-family: var(--font);
      font-size: 0.78rem;
      color: rgba(232,228,220,0.45);
      margin-bottom: 18px;
      letter-spacing: 0.01em;
    }
    .rmp-cards {
      display: flex;
      flex-direction: column;
      gap: 10px;
      width: 100%;
    }
    .rmp-card {
      display: flex;
      flex-direction: column;
      align-items: flex-start;
      gap: 4px;
      padding: 14px 16px;
      background: rgba(201,168,76,0.02);
      border: 1px solid rgba(201,168,76,0.08);
      border-radius: 12px;
      cursor: pointer;
      transition: all 0.18s ease;
      text-align: left;
    }
    .rmp-card:hover {
      background: rgba(201,168,76,0.05);
      border-color: rgba(201,168,76,0.18);
      transform: translateY(-1px);
    }
    .rmp-card:active { transform: translateY(0); }
    .rmp-card-name {
      font-family: var(--font);
      font-size: 0.78rem;
      font-weight: 600;
      color: rgba(232,228,220,0.85);
      letter-spacing: -0.01em;
    }
    .rmp-card-desc {
      font-family: var(--sans);
      font-size: 0.58rem;
      color: rgba(232,228,220,0.35);
      line-height: 1.4;
    }
    .rmp-hint {
      margin-top: 20px;
      font-family: var(--sans);
      font-size: 0.52rem;
      color: rgba(232,228,220,0.18);
      text-align: center;
      line-height: 1.5;
    }

    /* --- Sphere section --- */
    .sphere-section {
      position: relative;
      width: 100%;
      height: 58vh;
      min-height: 400px;
      background: #000;
      flex-shrink: 0;
    }
    #sphere-plot {
      width: 100%;
      height: 100%;
      position: relative;
      z-index: 1;
    }

    /* --- Sphere overlays --- */
    .sphere-panel {
      position: absolute;
      z-index: 10;
      background: rgba(6,6,12,0.82);
      border: 1px solid rgba(201,168,76,0.07);
      border-radius: 10px;
      padding: 14px 18px;
      backdrop-filter: blur(14px);
      opacity: 0;
      animation: fadeIn 1.2s ease 0.6s forwards;
      overflow: hidden;
      transition: max-height 0.3s ease;
    }

    .right-panels {
      position: absolute;
      top: 0; bottom: 0; right: calc(50vw - 720px);
      z-index: 10;
      display: flex;
      flex-direction: column;
      justify-content: flex-start;
      padding-top: 3%;
      padding-bottom: 3%;
      gap: 8px;
      pointer-events: none;
      width: 310px;
    }
    .right-panels > * { pointer-events: auto; }
    .sphere-legend {
      position: relative;
      width: 100%;
      padding: 10px 14px;
    }
    .sphere-legend h4 {
      font-size: 0.66rem;
      text-transform: uppercase;
      letter-spacing: 0.14em;
      color: rgba(201,168,76,0.8);
      font-weight: 600;
      margin: 0 0 6px;
    }
    .legend-columns {
      display: flex;
      gap: 10px;
    }
    .legend-col {
      flex: 1;
      min-width: 0;
    }
    .legend-col-toggle {
      font-size: 0.6rem;
      color: rgba(201,168,76,0.85);
      font-weight: 600;
      text-transform: uppercase;
      letter-spacing: 0.06em;
      margin-bottom: 2px;
      cursor: pointer;
      display: flex;
      align-items: center;
      gap: 4px;
      user-select: none;
      transition: color 0.15s;
    }
    .legend-col-toggle:hover { color: rgba(201,168,76,0.6); }
    .legend-col-toggle input[type="checkbox"] {
      accent-color: #c9a84c;
      width: 9px; height: 9px;
      margin: 0;
      cursor: pointer;
    }
    .sphere-legend .legend-item {
      font-size: 0.64rem;
      gap: 3px;
      margin-bottom: 0;
      display: flex;
      align-items: center;
      line-height: 1.4;
      color: rgba(232,228,220,0.75);
      cursor: pointer;
      user-select: none;
      transition: opacity 0.12s;
    }
    .sphere-legend .legend-item.off { opacity: 0.15; }
    .sphere-legend .legend-item input[type="checkbox"] { display: none; }
    .sphere-legend .legend-item span:last-child {
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
    }
    .sphere-legend .legend-swatch {
      width: 7px;
      height: 7px;
      border-radius: 50%;
      flex-shrink: 0;
    }
    .legend-divider {
      height: 1px;
      background: rgba(201,168,76,0.06);
      margin: 6px 0;
    }
    .legend-edge-row {
      display: flex;
      align-items: center;
      gap: 5px;
      font-size: 0.64rem;
      color: rgba(232,228,220,0.7);
      margin-bottom: 2px;
      cursor: pointer;
      user-select: none;
    }
    .legend-edge-row.off { opacity: 0.15; }
    .legend-edge-row input[type="checkbox"] { display: none; }
    .legend-edge-swatch {
      width: 18px;
      height: 2px;
      border-radius: 1px;
      flex-shrink: 0;
    }

    /* Edge legend panel (bottom-right, above general controls) */
    .sphere-edge-panel {
      position: relative;
      width: 100%;
      padding: 10px 14px;
    }
    .sphere-edge-panel h4 {
      font-size: 0.66rem;
      text-transform: uppercase;
      letter-spacing: 0.14em;
      color: rgba(201,168,76,0.8);
      font-weight: 600;
      margin: 0 0 6px;
    }
    .sphere-edge-panel .edge-legend {
      margin-bottom: 8px;
    }

    /* --- Panel collapse (vertical) --- */
    .chat-header h4,
    .sphere-legend h4,
    .sphere-edge-panel h4 {
      cursor: pointer;
      user-select: none;
      display: flex;
      align-items: center;
      gap: 6px;
    }
    .chat-header h4::after,
    .sphere-legend h4::after,
    .sphere-edge-panel h4::after {
      content: '';
      font-size: 0.7rem;
      color: rgba(232,228,220,0.25);
      transition: transform 0.2s;
      margin-left: auto;
    }
    .chat-panel:not(.collapsed) .chat-header h4::after,
    .sphere-legend:not(.collapsed) h4::after,
    .sphere-edge-panel:not(.collapsed) h4::after {
      transform: rotate(90deg);
    }
    .chat-panel.collapsed {
      max-height: 28px;
      padding-top: 6px; padding-bottom: 6px;
    }
    .chat-panel.collapsed .chat-header {
      border-bottom: none;
    }
    .sphere-legend {
      max-height: 500px;
    }
    .sphere-legend.collapsed {
      max-height: 28px;
      padding-top: 6px; padding-bottom: 6px;
    }
    .sphere-legend.collapsed h4 { margin-bottom: 0; }
    .sphere-edge-panel {
      max-height: 120px;
    }
    .sphere-edge-panel.collapsed {
      max-height: 28px;
      padding-top: 6px; padding-bottom: 6px;
    }
    .sphere-edge-panel.collapsed h4 { margin-bottom: 0; }

    /* --- Viewer mode (immersive zoom) --- */
    .page-wrap.search-active .sphere-section {
      position: absolute;
      width: 1px;
      height: 1px;
      overflow: hidden;
      clip: rect(0,0,0,0);
      pointer-events: none;
    }
    .page-wrap.search-active .home-chat {
      flex: 1;
      height: 100vh;
      justify-content: flex-start;
      padding-top: 40px;
      overflow: hidden;
    }
    .page-wrap.search-active .home-chat-inner {
      max-height: calc(100vh - 60px);
      overflow: hidden;
      display: flex;
      flex-direction: column;
    }
    .page-wrap.search-active #home-search-results {
      max-height: none;
      flex: 1;
      overflow-y: auto;
      padding-bottom: 80px;
    }
    .sphere-section .hero-header,
    .sphere-section .sphere-stats-float,
    .sphere-section .right-panels {
      transition: opacity 0.5s ease;
    }
    .sphere-section.viewer-mode .hero-header,
    .sphere-section.viewer-mode .sphere-stats-float,
    .sphere-section.viewer-mode .right-panels,
    .sphere-section.viewer-mode .right-panels .left-panel-removed {
      opacity: 0 !important;
      pointer-events: none;
    }
    .viewer-exit {
      display: none;
      position: absolute;
      top: 20px; left: 50%;
      transform: translateX(-50%);
      z-index: 30;
      background: rgba(6,6,12,0.7);
      border: 1px solid rgba(201,168,76,0.2);
      border-radius: 8px;
      color: rgba(232,228,220,0.6);
      font-family: var(--mono);
      font-size: 0.72rem;
      padding: 8px 20px;
      cursor: pointer;
      backdrop-filter: blur(12px);
      letter-spacing: 0.04em;
      transition: border-color 0.2s, color 0.2s, opacity 0.4s;
    }
    .viewer-exit:hover {
      border-color: rgba(201,168,76,0.5);
      color: #c9a84c;
    }
    .sphere-section.viewer-mode .viewer-exit {
      display: block;
      animation: fadeIn 0.6s ease 0.4s both;
    }

    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(6px); }
      to   { opacity: 1; transform: translateY(0); }
    }

    /* --- Homepage AI chat section --- */
    .home-chat {
      position: relative;
      width: 100%;
      flex: 1;
      background: #000;
      display: flex;
      flex-direction: column;
      align-items: center;
      padding: 12px 20px 40px;
    }
    .home-chat-inner {
      width: 100%;
      max-width: 680px;
      display: flex;
      flex-direction: column;
      align-items: center;
      flex: 1;
      opacity: 0;
      animation: fadeIn 0.8s ease 0.5s forwards;
    }
    .home-chat-model .cd-trigger {
      font-size: 0.72rem;
      color: rgba(232,228,220,0.55);
    }
    .home-chat-model .cd-menu {
      top: calc(100% + 4px);
      bottom: auto;
    }
    .home-chat.chatting .home-chat-model .cd-menu {
      top: auto;
      bottom: calc(100% + 6px);
      border-radius: 10px;
      box-shadow: 0 -4px 24px rgba(0,0,0,0.5), 0 0 0 1px rgba(232,228,220,0.06);
    }
    .home-chat-input-footer {
      display: flex;
      align-items: center;
      gap: 12px;
      margin-bottom: 10px;
      padding: 0 4px;
    }
    .home-chat-welcome {
      text-align: center;
      margin-bottom: 28px;
    }
    .home-chat-title {
      font-size: 1.4rem;
      font-weight: 600;
      color: rgba(232,228,220,0.6);
      letter-spacing: -0.02em;
      margin-bottom: 24px;
    }
    .home-read-btn {
      display: inline-flex;
      align-items: center;
      gap: 10px;
      padding: 13px 28px;
      background: rgba(201,168,76,0.08);
      border: 1px solid rgba(201,168,76,0.18);
      border-radius: 14px;
      color: rgba(232,228,220,0.75);
      font-family: var(--font);
      font-size: 0.82rem;
      font-weight: 500;
      cursor: pointer;
      transition: all 0.25s ease;
    }
    .home-read-btn:hover {
      border-color: rgba(201,168,76,0.35);
      color: rgba(232,228,220,0.95);
      background: rgba(201,168,76,0.14);
      box-shadow: 0 0 20px rgba(201,168,76,0.08);
    }
    .home-read-btn svg { opacity: 0.6; flex-shrink: 0; }
    .home-mode-toggle {
      display: flex;
      background: rgba(255,255,255,0.04);
      border-radius: 10px;
      padding: 3px;
      margin-bottom: 16px;
      width: 220px;
      align-self: center;
    }
    .home-mode-toggle button {
      flex: 1;
      background: none;
      border: none;
      color: rgba(232,228,220,0.4);
      font-family: var(--font);
      font-size: 0.74rem;
      font-weight: 500;
      letter-spacing: 0.02em;
      padding: 8px 0;
      cursor: pointer;
      border-radius: 8px;
      transition: color 0.2s, background 0.2s;
    }
    .home-mode-toggle button.active {
      background: rgba(201,168,76,0.13);
      color: rgba(232,228,220,0.92);
    }
    .home-mode-toggle button:hover:not(.active) {
      color: rgba(232,228,220,0.6);
    }
    #home-search-results {
      width: 100%;
      flex: 1;
      overflow-y: auto;
      padding: 0 0 16px;
      max-height: 50vh;
      scrollbar-width: thin;
      scrollbar-color: rgba(201,168,76,0.1) transparent;
      animation: srFadeIn 0.5s ease both;
    }
    @keyframes srFadeIn {
      from { opacity: 0; transform: translateY(10px); }
      to { opacity: 1; transform: translateY(0); }
    }
    @keyframes srItemIn {
      from { opacity: 0; transform: translateY(6px); }
      to { opacity: 1; transform: translateY(0); }
    }
    .search-loading-bar {
      display: none;
      width: 100%;
      max-width: 680px;
      flex-direction: column;
      align-items: center;
      gap: 10px;
      padding: 16px 0;
    }
    .search-loading-bar.active { display: flex; }
    .search-loading-bar.active ~ .home-chat-input-area { display: none !important; }
    .search-loading-dots {
      display: flex;
      gap: 6px;
    }
    .search-loading-dots span {
      width: 5px;
      height: 5px;
      border-radius: 50%;
      background: rgba(201,168,76,0.7);
      animation: rcmlPulse 1.4s ease-in-out infinite;
    }
    .search-loading-dots span:nth-child(2) { animation-delay: 0.2s; }
    .search-loading-dots span:nth-child(3) { animation-delay: 0.4s; }
    .search-loading-text {
      font-family: var(--sans);
      font-size: 0.68rem;
      font-weight: 500;
      color: rgba(232,228,220,0.5);
      letter-spacing: 0.02em;
    }
    .search-loading-track {
      width: 60%;
      max-width: 200px;
      height: 2px;
      background: rgba(232,228,220,0.06);
      border-radius: 1px;
      overflow: hidden;
    }
    .search-loading-fill {
      height: 100%;
      width: 0%;
      background: rgba(201,168,76,0.6);
      border-radius: 1px;
      transition: width 0.3s ease;
    }
    .search-back-btn {
      display: inline-flex;
      align-items: center;
      gap: 6px;
      background: none;
      border: 1px solid rgba(201,168,76,0.15);
      border-radius: 8px;
      color: rgba(232,228,220,0.5);
      font-family: var(--sans);
      font-size: 0.68rem;
      padding: 6px 14px;
      cursor: pointer;
      transition: all 0.2s;
      margin-bottom: 12px;
    }
    .search-back-btn:hover {
      color: rgba(232,228,220,0.8);
      border-color: rgba(201,168,76,0.3);
      background: rgba(201,168,76,0.06);
    }
    .search-back-btn svg { opacity: 0.5; }
    #home-search-status {
      text-align: center;
      font-size: 0.62rem;
      font-family: var(--mono);
      color: rgba(201,168,76,0.5);
      padding: 8px 0;
      letter-spacing: 0.06em;
    }
    #home-search-results-desc {
      font-size: 0.58rem;
      color: rgba(232,228,220,0.5);
      margin-bottom: 8px;
      line-height: 1.5;
    }
    .home-search-footer {
      display: flex;
      align-items: center;
      gap: 12px;
      margin-bottom: 10px;
      padding: 0 4px;
    }
    .home-search-mode-toggle {
      display: flex;
      background: rgba(255,255,255,0.04);
      border-radius: 8px;
      padding: 2px;
      flex-shrink: 0;
    }
    .home-search-mode-toggle button {
      background: none;
      border: none;
      color: rgba(232,228,220,0.4);
      font-family: var(--font);
      font-size: 0.64rem;
      font-weight: 500;
      padding: 5px 12px;
      cursor: pointer;
      border-radius: 6px;
      transition: color 0.2s, background 0.2s;
    }
    .home-search-mode-toggle button.active {
      background: rgba(201,168,76,0.13);
      color: rgba(232,228,220,0.9);
    }
    .home-search-mode-toggle button:hover:not(.active) {
      color: rgba(232,228,220,0.6);
    }
    .home-search-desc {
      font-size: 0.6rem;
      color: rgba(232,228,220,0.32);
      line-height: 1.5;
    }
    .search-filter-wrap {
      position: relative;
      flex-shrink: 0;
    }
    .search-filter-btn {
      display: flex;
      align-items: center;
      gap: 6px;
      background: transparent;
      border: 1px solid rgba(232,228,220,0.08);
      border-radius: 20px;
      color: rgba(232,228,220,0.5);
      font-family: var(--font);
      font-size: 0.62rem;
      padding: 5px 12px 5px 9px;
      cursor: pointer;
      transition: all 0.2s ease;
    }
    .search-filter-btn:hover {
      border-color: rgba(232,228,220,0.18);
      color: rgba(232,228,220,0.8);
      background: rgba(255,255,255,0.03);
    }
    .search-filter-btn svg {
      opacity: 0.45;
      transition: opacity 0.2s;
    }
    .search-filter-btn:hover svg { opacity: 0.7; }
    .search-filter-btn.filtered {
      border-color: rgba(201,168,76,0.3);
      color: rgba(201,168,76,0.85);
      background: rgba(201,168,76,0.06);
    }
    .search-filter-btn.filtered svg { opacity: 0.8; }

    .search-filter-backdrop {
      display: none;
      position: fixed;
      inset: 0;
      background: rgba(0,0,0,0.4);
      z-index: 999;
      backdrop-filter: blur(4px);
      -webkit-backdrop-filter: blur(4px);
    }
    .search-filter-backdrop.open { display: block; }
    .search-filter-dropdown {
      position: fixed;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%) scale(0.96);
      width: min(520px, 92vw);
      max-height: min(460px, 70vh);
      overflow-y: auto;
      background: rgba(20,20,30,0.98);
      border: 1px solid rgba(232,228,220,0.08);
      border-radius: 16px;
      padding: 20px;
      z-index: 1000;
      backdrop-filter: blur(24px);
      -webkit-backdrop-filter: blur(24px);
      box-shadow: 0 16px 48px rgba(0,0,0,0.55), 0 0 0 1px rgba(255,255,255,0.04) inset;
      opacity: 0;
      pointer-events: none;
      transition: opacity 0.2s ease, transform 0.2s ease;
      scrollbar-width: thin;
      scrollbar-color: rgba(232,228,220,0.06) transparent;
    }
    .search-filter-dropdown.open {
      opacity: 1;
      pointer-events: auto;
      transform: translate(-50%, -50%) scale(1);
    }
    .search-filter-dropdown::-webkit-scrollbar { width: 4px; }
    .search-filter-dropdown::-webkit-scrollbar-track { background: transparent; }
    .search-filter-dropdown::-webkit-scrollbar-thumb {
      background: rgba(232,228,220,0.08);
      border-radius: 4px;
    }
    .search-filter-dropdown::-webkit-scrollbar-thumb:hover { background: rgba(232,228,220,0.14); }

    .sfd-top-row {
      display: flex;
      align-items: center;
      justify-content: space-between;
      margin-bottom: 14px;
    }
    .sfd-header {
      font-size: 0.78rem;
      font-weight: 600;
      color: rgba(232,228,220,0.85);
      letter-spacing: 0.02em;
    }
    .sfd-done {
      background: rgba(232,228,220,0.06);
      border: 1px solid rgba(232,228,220,0.1);
      color: rgba(232,228,220,0.6);
      font-family: var(--font);
      font-size: 0.65rem;
      font-weight: 500;
      letter-spacing: 0.03em;
      padding: 5px 16px;
      border-radius: 20px;
      cursor: pointer;
      transition: all 0.15s ease;
    }
    .sfd-done:hover {
      background: rgba(232,228,220,0.12);
      border-color: rgba(232,228,220,0.18);
      color: rgba(232,228,220,0.9);
    }
    .sfd-columns {
      display: flex;
      gap: 0;
    }
    .sfd-divider-v {
      width: 1px;
      background: linear-gradient(180deg, transparent, rgba(232,228,220,0.06), transparent);
      margin: 0 14px;
      flex-shrink: 0;
    }
    .sfd-section { margin-bottom: 6px; flex: 1; min-width: 0; }
    .sfd-section:last-child { margin-bottom: 0; }
    .sfd-toggle {
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 8px 2px 6px;
      cursor: pointer;
      user-select: none;
    }
    .sfd-toggle span:first-child {
      font-size: 0.68rem;
      font-weight: 600;
      color: rgba(232,228,220,0.7);
      letter-spacing: 0.03em;
      text-transform: uppercase;
    }
    .sfd-track {
      position: relative;
      width: 30px; height: 16px;
      background: rgba(255,255,255,0.07);
      border-radius: 8px;
      flex-shrink: 0;
      cursor: pointer;
      transition: background 0.25s ease;
    }
    .sfd-track input { display: none; }
    .sfd-track::after {
      content: '';
      position: absolute;
      top: 2px; left: 2px;
      width: 12px; height: 12px;
      border-radius: 50%;
      background: rgba(232,228,220,0.25);
      transition: transform 0.25s cubic-bezier(0.4,0,0.2,1), background 0.25s ease;
    }
    .sfd-track.on { background: rgba(201,168,76,0.28); }
    .sfd-track.on::after {
      transform: translateX(14px);
      background: rgba(201,168,76,0.9);
    }
    .sfd-track.partial { background: rgba(201,168,76,0.16); }
    .sfd-track.partial::after {
      transform: translateX(7px);
      background: rgba(201,168,76,0.55);
    }
    .sfd-books {
      display: flex;
      flex-direction: column;
      gap: 1px;
      padding: 4px 0 6px;
    }
    .sfd-book {
      display: flex;
      align-items: center;
      gap: 6px;
      padding: 4px 6px;
      cursor: pointer;
      user-select: none;
      border-radius: 6px;
      transition: background 0.15s ease;
    }
    .sfd-book:hover {
      background: rgba(255,255,255,0.04);
    }
    .sfd-book-swatch {
      width: 7px; height: 7px;
      border-radius: 50%;
      flex-shrink: 0;
      transition: opacity 0.2s ease;
    }
    .sfd-book span:last-child {
      font-size: 0.58rem;
      color: rgba(232,228,220,0.5);
      transition: color 0.15s ease;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
    }
    .sfd-book:hover span:last-child { color: rgba(232,228,220,0.85); }
    .sfd-book.off span:last-child { color: rgba(232,228,220,0.15); }
    .sfd-book.off .sfd-book-swatch { opacity: 0.15; }
    .sfd-divider {
      height: 1px;
      background: linear-gradient(90deg, transparent, rgba(232,228,220,0.06), transparent);
      margin: 8px 0;
    }
    .sfd-divider-v + .sfd-section .sfd-books { padding-top: 4px; }
    .home-chat-messages {
      width: 100%;
      flex: 1;
      overflow-y: auto;
      padding: 16px 0;
      scrollbar-width: thin;
      scrollbar-color: rgba(201,168,76,0.1) transparent;
    }
    .home-chat-messages::-webkit-scrollbar { width: 4px; }
    .home-chat-messages::-webkit-scrollbar-track { background: transparent; }
    .home-chat-messages::-webkit-scrollbar-thumb { background: rgba(201,168,76,0.12); border-radius: 4px; }

    /* Full-screen chat overlay state */
    .home-chat.chatting {
      position: fixed;
      inset: 0;
      z-index: 9000;
      min-height: 100vh;
      padding: 0;
      animation: chatOverlayIn 0.4s cubic-bezier(0.23, 1, 0.32, 1) forwards;
    }
    @keyframes chatOverlayIn {
      0% { opacity: 0; }
      100% { opacity: 1; }
    }
    .home-chat.chatting .home-chat-inner {
      max-width: 720px;
      height: 100vh;
      padding: 0 20px;
      opacity: 1;
      animation: none;
    }
    .home-chat.chatting .home-chat-welcome,
    .home-chat.chatting .home-mode-toggle,
    .home-chat.chatting .home-search-footer,
    .home-chat.chatting #home-search-results,
    .home-chat.chatting .search-loading-bar,
    .home-chat.chatting .model-picker,
    .home-chat.chatting .home-chat-model-loading:not(.active) {
      display: none !important;
    }
    .home-chat.chatting .home-chat-input-footer {
      display: flex !important;
    }
    .home-chat.chatting .home-chat-messages {
      display: flex !important;
      flex-direction: column;
      flex: 1;
      min-height: 0;
      padding: 80px 0 16px;
    }
    .home-chat.chatting .home-chat-input-area {
      flex-shrink: 0;
      padding-bottom: 24px;
    }
    .home-chat.chatting .home-chat-disclaimer {
      display: none !important;
    }

    .home-chat-back {
      display: none;
      position: absolute;
      top: 22px;
      left: 22px;
      z-index: 10;
      background: none;
      border: 1px solid rgba(232,228,220,0.06);
      border-radius: 10px;
      color: rgba(232,228,220,0.35);
      cursor: pointer;
      padding: 7px 14px 7px 10px;
      font-family: var(--font);
      font-size: 0.7rem;
      font-weight: 500;
      letter-spacing: 0.01em;
      transition: all 0.2s ease;
      align-items: center;
      gap: 6px;
    }
    .home-chat-back:hover {
      color: rgba(232,228,220,0.7);
      border-color: rgba(232,228,220,0.12);
      background: rgba(232,228,220,0.03);
    }
    .home-chat-back svg { width: 14px; height: 14px; }
    .home-chat.chatting .home-chat-back { display: inline-flex; }

    .home-chat-header-title {
      display: none;
      position: absolute;
      top: 24px;
      left: 50%;
      transform: translateX(-50%);
      font-family: var(--font);
      font-size: 0.72rem;
      font-weight: 600;
      letter-spacing: -0.01em;
      color: rgba(232,228,220,0.4);
    }
    .home-chat.chatting .home-chat-header-title { display: block; }

    /* Model picker */
    .model-picker {
      width: 100%;
      max-width: 480px;
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 20px;
      padding: 14px 0 20px;
      animation: mpFadeIn 0.4s ease both;
    }
    @keyframes mpFadeIn {
      from { opacity: 0; transform: translateY(8px); }
      to { opacity: 1; transform: translateY(0); }
    }
    .model-picker-label {
      font-family: var(--font);
      font-size: 0.82rem;
      font-weight: 500;
      color: rgba(232,228,220,0.4);
      letter-spacing: 0.01em;
    }
    .model-picker-cards {
      display: flex;
      gap: 12px;
      width: 100%;
    }
    .model-card {
      flex: 1;
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 6px;
      padding: 20px 12px 16px;
      background: rgba(232,228,220,0.02);
      border: 1px solid rgba(232,228,220,0.06);
      border-radius: 12px;
      cursor: pointer;
      transition: all 0.2s ease;
      position: relative;
    }
    .model-card:hover {
      background: rgba(201,168,76,0.04);
      border-color: rgba(201,168,76,0.15);
      transform: translateY(-2px);
    }
    .model-card:active { transform: translateY(0); }
    .model-card-name {
      font-family: var(--font);
      font-size: 0.82rem;
      font-weight: 600;
      color: rgba(232,228,220,0.8);
      letter-spacing: -0.01em;
    }
    .model-card-desc {
      font-family: var(--sans);
      font-size: 0.6rem;
      color: rgba(232,228,220,0.35);
      text-align: center;
      line-height: 1.4;
    }
    .model-card-size {
      font-family: var(--sans);
      font-size: 0.52rem;
      color: rgba(201,168,76,0.4);
      margin-top: 4px;
      letter-spacing: 0.03em;
    }

    .home-chat-model-loading {
      display: none;
      width: 100%;
      padding: 20px 0;
      align-items: center;
      justify-content: center;
      flex-direction: column;
    }
    .home-chat-model-loading.active:not(.hidden-by-mode) { display: flex; }
    .home-chat-model-loading.active:not(.hidden-by-mode) ~ .home-chat-input-area {
      display: none !important;
    }
    .home-chat-input-area {
      width: 100%;
    }
    .home-chat-input-wrap {
      position: relative;
      display: flex;
      align-items: center;
    }
    #home-chat-input {
      width: 100%;
      background: rgba(12,12,20,0.95);
      border: 1px solid rgba(232,228,220,0.07);
      border-radius: 24px;
      color: #e8e4dc;
      font-family: var(--font);
      font-size: 0.86rem;
      padding: 14px 54px 14px 22px;
      outline: none;
      transition: border-color 0.2s;
      -webkit-appearance: none;
      appearance: none;
    }
    #home-chat-input::placeholder { color: rgba(232,228,220,0.22); }
    #home-chat-input:focus { border-color: rgba(201,168,76,0.28); }
    .home-chat-send {
      position: absolute;
      right: 8px;
      width: 36px;
      height: 36px;
      border-radius: 50%;
      border: none;
      background: rgba(201,168,76,0.7);
      color: #0a0a14;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      transition: background 0.15s, opacity 0.15s;
      opacity: 0.35;
    }
    .home-chat-send:hover { background: #c9a84c; opacity: 1; }
    .home-chat-send.ready { opacity: 1; }
    .home-chat-stop {
      position: absolute;
      right: 8px;
      width: 36px;
      height: 36px;
      border-radius: 50%;
      border: 1px solid rgba(232,228,220,0.12);
      background: rgba(232,228,220,0.06);
      color: rgba(232,228,220,0.6);
      cursor: pointer;
      display: none;
      align-items: center;
      justify-content: center;
      transition: all 0.2s ease;
    }
    .home-chat-stop:hover {
      background: rgba(232,228,220,0.1);
      border-color: rgba(232,228,220,0.2);
      color: rgba(232,228,220,0.85);
    }
    .home-chat-stop { display: none !important; }
    .home-chat-disclaimer {
      display: none;
      font-size: 0.6rem;
      color: rgba(232,228,220,0.38);
      letter-spacing: 0.02em;
      margin-top: 8px;
      text-align: center;
      width: 100%;
    }

    .home-footer {
      position: fixed;
      bottom: 16px;
      left: 0;
      right: 0;
      text-align: center;
      font-family: var(--mono);
      font-size: 0.72rem;
      color: rgba(232,228,220,0.3);
      letter-spacing: 0.04em;
      pointer-events: none;
      z-index: 10;
    }
    .home-footer a {
      color: rgba(232,228,220,0.3);
      text-decoration: none;
      pointer-events: auto;
      transition: color 0.2s;
    }
    .home-footer a:hover {
      color: rgba(232,228,220,0.55);
    }

    /* --- Methodology --- */
    .methodology-overlay {
      display: none;
      position: fixed;
      inset: 0;
      z-index: 10000;
      background: rgba(0,0,0,0.7);
      backdrop-filter: blur(8px);
      align-items: center;
      justify-content: center;
    }
    .methodology-overlay.open { display: flex; }
    .methodology {
      max-width: 860px;
      width: 90vw;
      max-height: 80vh;
      overflow-y: auto;
      background: rgba(10,10,18,0.98);
      border: 1px solid rgba(232,228,220,0.06);
      border-radius: 16px;
      padding: 2.5rem 2.5rem 2rem;
      position: relative;
      scrollbar-width: thin;
      scrollbar-color: rgba(201,168,76,0.1) transparent;
      box-shadow: 0 24px 80px rgba(0,0,0,0.6);
    }
    .methodology-close {
      position: absolute;
      top: 16px;
      right: 16px;
      background: none;
      border: 1px solid rgba(232,228,220,0.06);
      border-radius: 8px;
      color: rgba(232,228,220,0.3);
      width: 32px;
      height: 32px;
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      font-size: 0.9rem;
      transition: all 0.2s;
    }
    .methodology-close:hover {
      color: rgba(232,228,220,0.7);
      border-color: rgba(232,228,220,0.12);
      background: rgba(232,228,220,0.03);
    }
    .methodology h2 {
      font-size: 0.72rem;
      text-transform: uppercase;
      letter-spacing: 0.14em;
      color: rgba(201,168,76,0.45);
      font-weight: 600;
      margin-bottom: 2rem;
      text-align: center;
    }
    .method-block {
      margin-bottom: 2rem;
    }
    .method-block h3 {
      font-size: 0.82rem;
      font-weight: 600;
      color: rgba(232,228,220,0.7);
      margin-bottom: 0.5rem;
      letter-spacing: 0;
    }
    .method-block p {
      font-size: 0.82rem;
      color: rgba(232,228,220,0.35);
      line-height: 1.8;
    }
    .method-block .katex-display {
      margin: 1rem 0;
    }
    .method-block .katex { font-size: 0.92em; }

    /* --- Representative verses --- */
    .rep-verses {
      max-width: 1000px;
      margin: 0 auto;
      padding: 3rem 2rem 2rem;
    }
    .rep-verses h2 {
      font-size: 0.72rem;
      text-transform: uppercase;
      letter-spacing: 0.14em;
      color: rgba(201,168,76,0.45);
      font-weight: 600;
      margin-bottom: 0.5rem;
      text-align: center;
    }
    .rep-verses .rep-sub {
      font-size: 0.76rem;
      color: rgba(232,228,220,0.25);
      text-align: center;
      margin-bottom: 2rem;
      line-height: 1.6;
    }
    .rv-group {
      margin-bottom: 1rem;
    }
    .rv-toggle {
      width: 100%;
      background: rgba(12,12,20,0.6);
      border: 1px solid rgba(201,168,76,0.1);
      border-radius: 8px;
      color: rgba(201,168,76,0.5);
      font-size: 0.72rem;
      font-weight: 600;
      text-transform: uppercase;
      letter-spacing: 0.1em;
      padding: 12px 18px;
      cursor: pointer;
      text-align: left;
      display: flex;
      justify-content: space-between;
      align-items: center;
      transition: border-color 0.2s, color 0.2s;
    }
    .rv-toggle:hover { border-color: rgba(201,168,76,0.3); color: #c9a84c; }
    .rv-toggle.open { border-radius: 8px 8px 0 0; border-bottom-color: transparent; }
    .rv-toggle.open .rv-arrow { transform: rotate(90deg); }
    .rv-arrow { transition: transform 0.2s; font-size: 0.6rem; }
    .rv-search-wrap {
      background: rgba(12,12,20,0.6);
      border: 1px solid rgba(201,168,76,0.1);
      border-top: none;
      padding: 8px 14px;
    }
    .rv-search {
      width: 100%;
      background: rgba(6,6,12,0.8);
      border: 1px solid rgba(201,168,76,0.08);
      border-radius: 5px;
      color: #e8e4dc;
      font-family: var(--font);
      font-size: 0.72rem;
      padding: 7px 12px;
      outline: none;
    }
    .rv-search::placeholder { color: rgba(232,228,220,0.15); }
    .rv-search:focus { border-color: rgba(201,168,76,0.25); }
    .rv-list {
      background: rgba(12,12,20,0.6);
      border: 1px solid rgba(201,168,76,0.1);
      border-top: none;
      border-radius: 0 0 8px 8px;
      padding: 0 18px 12px;
      max-height: 500px;
      overflow-y: auto;
    }
    .rv-card {
      padding: 10px 0;
      border-bottom: 1px solid rgba(255,255,255,0.03);
    }
    .rv-header {
      display: flex;
      align-items: center;
      gap: 6px;
      margin-bottom: 3px;
    }
    .rv-dot {
      width: 7px;
      height: 7px;
      border-radius: 50%;
      flex-shrink: 0;
    }
    .rv-book {
      font-size: 0.76rem;
      font-weight: 600;
      color: rgba(232,228,220,0.7);
    }
    .rv-meta {
      font-size: 0.58rem;
      font-family: var(--mono);
      color: rgba(232,228,220,0.18);
      margin-left: auto;
    }
    .rv-ref {
      font-size: 0.68rem;
      color: rgba(201,168,76,0.5);
      font-weight: 500;
      margin-bottom: 2px;
    }
    .rv-text {
      font-size: 0.78rem;
      color: rgba(232,228,220,0.35);
      line-height: 1.7;
      font-style: italic;
    }

    /* --- Below fold --- */
    .below-fold {
      position: relative;
      z-index: 3;
      background: #000;
    }
    .below-fold main {
      max-width: 1200px;
      margin: 0 auto;
      padding: 4rem 2rem 3rem;
    }
    .section-label {
      font-size: 0.7rem;
      text-transform: uppercase;
      letter-spacing: 0.15em;
      color: rgba(201,168,76,0.45);
      font-weight: 600;
      margin-bottom: 2rem;
      text-align: center;
    }
    .module-grid {
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      gap: 1.5rem;
    }
    .module-card {
      background: rgba(10,10,18,0.7);
      border: 1px solid rgba(201,168,76,0.06);
      border-radius: 12px;
      padding: 2.5rem 2rem;
      text-decoration: none;
      color: var(--text);
      transition: border-color 0.3s, transform 0.2s, box-shadow 0.3s;
      display: flex;
      flex-direction: column;
    }
    .module-card:hover {
      border-color: rgba(201,168,76,0.2);
      transform: translateY(-3px);
      box-shadow: 0 12px 40px rgba(201,168,76,0.04);
      color: var(--text);
    }
    .module-num {
      font-family: var(--mono);
      font-size: 0.7rem;
      color: rgba(201,168,76,0.35);
      letter-spacing: 0.1em;
      margin-bottom: 1.2rem;
    }
    .module-card h2 { font-size: 1.3rem; font-weight: 600; margin-bottom: 0.7rem; }
    .module-card p { color: rgba(232,228,220,0.38); font-size: 0.86rem; line-height: 1.7; flex-grow: 1; }
    .module-enter {
      margin-top: 1.5rem;
      font-size: 0.76rem;
      color: rgba(201,168,76,0.4);
      font-weight: 500;
      letter-spacing: 0.04em;
      transition: color 0.2s;
    }
    .module-card:hover .module-enter { color: #c9a84c; }

    .manifesto {
      max-width: 600px;
      margin: 4rem auto 0;
      text-align: center;
      padding: 3rem 0;
      border-top: 1px solid rgba(201,168,76,0.04);
    }
    .manifesto h3 {
      font-size: 0.72rem;
      text-transform: uppercase;
      letter-spacing: 0.12em;
      color: rgba(201,168,76,0.35);
      margin-bottom: 1.5rem;
    }
    .manifesto p { color: rgba(232,228,220,0.3); font-size: 0.86rem; line-height: 1.9; }

    .hero-footer {
      text-align: center;
      padding: 2.5rem 2rem;
      color: rgba(232,228,220,0.12);
      font-size: 0.7rem;
      font-family: var(--mono);
      letter-spacing: 0.04em;
      border-top: 1px solid rgba(255,255,255,0.02);
    }

    @media (max-width: 800px) {
      .sphere-section { display: none !important; }
      .mobile-topbar { display: flex !important; }
      .page-wrap {
        height: 100vh;
        height: 100dvh;
        display: flex;
        flex-direction: column;
      }

      /* Hide desktop-only elements */
      .mobile-hide-btn { display: none !important; }
      .mobile-header { display: none !important; }
      .home-mode-toggle { display: none !important; }
      .model-picker { display: none !important; }
      .home-search-footer { display: none !important; }
      .home-chat-back { display: none !important; }
      .home-chat-header-title { display: none !important; }
      .search-loading-bar { display: none !important; }
      .home-chat-model-loading { display: none !important; }
      .home-footer { display: none !important; }

      /* ChatGPT-style full-height chat layout */
      .home-chat {
        flex: 1;
        display: flex !important;
        flex-direction: column;
        padding: 0 !important;
        justify-content: flex-start;
      }
      .home-chat-inner {
        flex: 1;
        max-width: 100%;
        display: flex;
        flex-direction: column;
        opacity: 1 !important;
        animation: none !important;
      }

      /* Welcome area  centered vertically in available space */
      .home-chat-welcome {
        flex: 1;
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        padding: 0 24px;
        margin: 0;
      }
      .home-chat-title {
        font-size: 1.6rem !important;
        margin-bottom: 20px !important;
        text-align: center;
        color: rgba(232,228,220,0.6);
        font-weight: 400;
      }
      .home-read-btn {
        font-size: 1rem !important;
        padding: 14px 28px !important;
        border-radius: 14px !important;
        margin-bottom: 28px !important;
      }
      .home-read-btn svg { width: 18px !important; height: 18px !important; }

      /* Suggestion chips */
      .mobile-suggestions {
        display: flex !important;
        flex-wrap: wrap;
        justify-content: center;
        gap: 8px;
        padding: 0 16px;
        max-width: 400px;
      }

      /* Messages area */
      .home-chat-messages {
        flex: 1;
        padding: 12px 16px !important;
        overflow-y: auto;
      }
      .chat-msg { font-size: 1rem !important; line-height: 1.65 !important; }
      .chat-msg-label { font-size: 0.75rem !important; }

      /* Input area  fixed bottom, ChatGPT-style */
      .home-chat-input-area {
        padding: 10px 14px 0;
        background: rgba(0,0,0,0.9);
        border-top: 1px solid rgba(255,255,255,0.04);
      }
      .home-chat-input-footer {
        font-size: 0.8rem !important;
        gap: 8px !important;
        margin-bottom: 8px !important;
      }
      .home-chat-input-wrap #home-chat-input {
        font-size: 1rem !important;
        padding: 16px 50px 16px 18px !important;
        border-radius: 28px !important;
        min-height: 56px !important;
        background: rgba(255,255,255,0.06) !important;
        border: 1px solid rgba(255,255,255,0.08) !important;
      }
      .home-chat-send, .home-chat-stop {
        width: 38px !important;
        height: 38px !important;
        right: 6px !important;
      }
      .home-chat-send svg, .home-chat-stop svg {
        width: 16px !important;
        height: 16px !important;
      }

      /* Hide elements not needed on mobile */
      .home-search-mode-toggle { display: none !important; }
      .search-filter-btn { display: none !important; }
      .stats-info-btn { display: none !important; }
      .home-chat-input-footer,
      .home-chat.chatting .home-chat-input-footer { display: none !important; }
      .mobile-model-label { display: block !important; }
      .reader-model-picker { display: none !important; }
      .reader-chat-header .cd-wrap { display: none !important; }
      .cd-trigger { font-size: 0.85rem !important; }
      .cd-menu { font-size: 0.85rem !important; }
      .cd-item { padding: 10px 14px !important; font-size: 0.85rem !important; }

      /* Chatting state  use dvh so input isn't behind iOS bottom bar */
      .home-chat.chatting {
        min-height: 100dvh !important;
      }
      .home-chat.chatting .home-chat-inner {
        height: 100dvh !important;
      }
      .home-chat.chatting .home-chat-welcome { display: none !important; }
      .home-chat.chatting .home-chat-messages { display: block !important; }
      .home-chat.chatting .home-chat-back {
        display: flex !important;
        position: sticky;
        top: 0;
        z-index: 10;
        background: rgba(0,0,0,0.85);
        backdrop-filter: blur(12px);
        -webkit-backdrop-filter: blur(12px);
        padding: 10px 16px;
        font-size: 0.9rem;
        border-bottom: 1px solid rgba(255,255,255,0.04);
      }

      /* Splash  mobile: JS-driven transitions instead of CSS animations */
      .splash-cross { width: 80px !important; }
      .splash-title {
        font-size: 2.4rem !important;
        animation: none !important;
        opacity: 0;
        transform: translateY(10px);
        transition: opacity 1s ease-out, transform 1s ease-out;
        will-change: opacity, transform;
      }
      .splash-subtitle {
        font-size: 0.9rem !important;
        animation: none !important;
        opacity: 0;
        transform: translateY(10px);
        transition: opacity 1s ease-out, transform 1s ease-out;
        will-change: opacity, transform;
      }
      .splash-title.spl-visible,
      .splash-subtitle.spl-visible {
        opacity: 1;
        transform: translateY(0);
      }
      .splash.out .splash-title,
      .splash.out .splash-subtitle {
        opacity: 0 !important;
        transform: translateY(-12px) !important;
        transition: opacity 0.8s ease-in, transform 0.8s ease-in !important;
      }
      .rt-bible { width: 160px !important; height: 210px !important; }
      .rt-label { font-size: 0.75rem !important; }
      .rt-label-sub { font-size: 0.5rem !important; }
      .rt-cross-icon { width: 28px !important; height: 28px !important; }

      /* Reader topbar  reorganize for mobile */
      .reader-topbar {
        flex-direction: column !important;
        align-items: stretch !important;
        padding: 8px 16px 6px !important;
        gap: 4px !important;
      }
      .reader-topbar-left {
        position: static !important;
        transform: none !important;
        order: -1;
        display: flex;
        justify-content: space-between;
        align-items: center;
      }
      .reader-topbar-right {
        position: static !important;
        transform: none !important;
        justify-content: flex-end;
      }
      .reader-tl-label { font-size: 0.38rem !important; }
      .reader-tl-toggle button { font-size: 0.38rem !important; padding: 2px 5px !important; }
      .reader-topbar-center {
        order: 1;
        align-items: center;
      }
      .reader-topbar-title .cd-trigger { font-size: 1.15rem !important; font-weight: 700 !important; }
      .reader-topbar-title .cd-chev { width: 9px !important; height: 6px !important; }
      .reader-chapter-nav .cd-trigger { font-size: 0.9rem !important; }
      .reader-chapter-nav > button { width: 28px !important; height: 28px !important; font-size: 1rem !important; }
      .reader-close {
        width: 32px !important;
        height: 32px !important;
        font-size: 0 !important;
      }
      .reader-close::after {
        content: '';
        font-size: 1rem;
      }

      .reader-overlay {
        overflow: hidden !important;
        background: rgb(6,6,12) !important;
      }
      .reader-body { flex-direction: column !important; }
      .reader-content { position: relative !important; right: 0 !important; flex: 1; min-height: 0; overflow-y: auto; }
      .reader-inner { padding: 0 16px !important; font-size: 0.82rem !important; transform: none !important; }
      .reader-chapter-heading { font-size: 0.95rem !important; }
      .reader-verse { font-size: 0.82rem !important; line-height: 1.65 !important; }

      /* Reader chat */
      .reader-chat {
        width: 100% !important;
        min-width: 0 !important;
        max-height: 30vh;
        flex-shrink: 0;
        border-left: none !important;
        border-top: 1px solid rgba(201,168,76,0.06);
      }
      .reader-chat-header {
        min-width: 0 !important;
        padding: 12px 16px !important;
      }
      .reader-chat-header span { font-size: 0.85rem !important; }
      .reader-chat-header .cd-trigger { font-size: 0.95rem !important; }
      .reader-chat-settings { min-width: 0 !important; }
      .reader-chat-empty { font-size: 0.9rem !important; }
      .reader-chat-disclaimer,
      .reader-chat-settings-hint,
      .rmp-hint { display: none !important; }
      .rmp-label { font-size: 0.85rem !important; }
      .rmp-card { padding: 14px 16px !important; }
      .rmp-card-name { font-size: 0.85rem !important; }
      .rmp-card-desc { font-size: 0.7rem !important; }
      .reader-chat .chat-msg { font-size: 1rem !important; }
      .reader-chat .chat-msg-label { font-size: 0.75rem !important; }
      .reader-chat-input-wrap {
        padding: 8px 12px !important;
        min-width: 0 !important;
        border-top: 1px solid rgba(255,255,255,0.04) !important;
        align-items: center !important;
        gap: 8px !important;
      }
      .reader-chat-input-wrap textarea {
        flex: 1 !important;
        font-size: 0.95rem !important;
        padding: 10px 14px !important;
        min-height: 40px !important;
        border-radius: 20px !important;
        background: rgba(255,255,255,0.06) !important;
        border: 1px solid rgba(255,255,255,0.08) !important;
        color: rgba(232,228,220,0.85) !important;
      }
      .reader-chat-input-wrap button {
        width: 36px !important;
        height: 36px !important;
        border-radius: 50% !important;
        background: rgba(201,168,76,0.7) !important;
        border: none !important;
        color: #0a0a14 !important;
        flex-shrink: 0 !important;
      }

      .module-grid { grid-template-columns: 1fr; }
      .methodology { padding: 2rem 1rem; }

      /* Filter modal */
      .search-filter-dropdown {
        font-size: 1.1rem !important;
        padding: 20px !important;
        max-width: 92vw !important;
      }
    }
  </style>
</head>
<body>

<!-- Splash intro -->
<div class="splash" id="splash">
  <div class="splash-glow"></div>
  <svg class="splash-cross" viewBox="0 0 80 140" fill="none">
    <defs>
      <linearGradient id="spl-gold" x1="40" y1="0" x2="40" y2="140" gradientUnits="userSpaceOnUse">
        <stop offset="0%" stop-color="#f5e08c"/>
        <stop offset="35%" stop-color="#c9a84c"/>
        <stop offset="100%" stop-color="#8a6d2e"/>
      </linearGradient>
    </defs>
    <rect x="33" y="0" width="14" height="140" rx="2" fill="url(#spl-gold)"/>
    <rect x="8" y="34" width="64" height="13" rx="2" fill="url(#spl-gold)"/>
  </svg>
  <div class="splash-title">BibleVerse</div>
  <div class="splash-subtitle">The Modern Bible Interface</div>
  <div class="splash-particles" id="splash-particles"></div>
</div>
<script>
(function(){
  var s=document.getElementById('splash'),pc=document.getElementById('splash-particles');
  for(var i=0;i<28;i++){
    var el=document.createElement('div');
    el.className='splash-particle';
    var sz=1.5+Math.random()*2;
    el.style.width=sz+'px';el.style.height=sz+'px';
    var a=Math.random()*Math.PI*2,r=18+Math.random()*40;
    el.style.setProperty('--sx',Math.cos(a)*r+'px');
    el.style.setProperty('--sy',Math.sin(a)*r+'px');
    var ea=a+(Math.random()-0.5)*0.9,er=70+Math.random()*90;
    el.style.setProperty('--ex',Math.cos(ea)*er+'px');
    el.style.setProperty('--ey',(Math.sin(ea)*er-50)+'px');
    el.style.setProperty('--d',(2.2+Math.random()*2)+'s');
    el.style.setProperty('--t',(1.6+Math.random()*1.6)+'s');
    pc.appendChild(el);
  }
  function dismiss(){
    if(s.classList.contains('out'))return;
    s.classList.add('out');
    setTimeout(function(){s.remove()}, window.innerWidth <= 800 ? 2200 : 1600);
  }
  var isMob = window.innerWidth <= 800;
  if (isMob) {
    var splT = s.querySelector('.splash-title');
    var splSub = s.querySelector('.splash-subtitle');
    setTimeout(function(){ if(splT) splT.classList.add('spl-visible'); }, 800);
    setTimeout(function(){ if(splSub) splSub.classList.add('spl-visible'); }, 1300);
  }
  setTimeout(dismiss, isMob ? 4600 : 3800);
  s.addEventListener('click',dismiss);
})();
</script>

<!-- Mobile notice -->
<div class="mobile-notice-overlay" id="mobile-notice">
  <div class="mobile-notice">
    <h2>Welcome to BibleVerse</h2>
    <p>The desktop version includes additional features like the interactive 3D cross-reference visualization. Everything else works great here.</p>
    <button class="mobile-notice-btn" id="mobile-notice-dismiss">Get started</button>
  </div>
</div>
<script>
(function(){
  if (window.innerWidth <= 800) {
    var overlay = document.getElementById('mobile-notice');
    setTimeout(function(){ overlay.style.display = 'flex'; }, 4200);
    document.getElementById('mobile-notice-dismiss').addEventListener('click', function(){
      overlay.style.display = 'none';
    });
  }
})();
</script>

<div class="page-wrap">
<!-- Sphere (full viewport  title, search, stats overlay the top) -->
<div class="sphere-section">
  <div class="hero-header">
    <h1>BibleVerse <span style="font-weight:300;"> The Modern Bible Interface</span></h1>
    <p class="sub">
      Efficient exploration of humanity's most consequential text
    </p>
  </div>
  <div class="sphere-stats-float">
    <span><b id="stat-verses"></b> verses &middot; <b id="stat-books"></b> books &middot; <b id="stat-refs"></b> cross-references</span>
    <button class="stats-info-btn" id="stats-info-btn" title="Methodology">i</button>
  </div>
  <button class="viewer-exit" id="viewer-exit">Exit viewer  Esc</button>
  <div id="sphere-plot"></div>




</div>

<!-- Mobile top bar (hidden on desktop) -->
<div class="mobile-topbar" id="mobile-topbar">
  <button class="mobile-topbar-book" id="mobile-open-reader" aria-label="Read Bible">
    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" width="22" height="22">
      <path d="M2 3h6a4 4 0 014 4v14a3 3 0 00-3-3H2z"/>
      <path d="M22 3h-6a4 4 0 00-4 4v14a3 3 0 013-3h7z"/>
    </svg>
  </button>
  <span class="mobile-topbar-title">BibleVerse <span style="opacity:0.45;font-weight:400;font-size:0.8em;">(Beta)</span></span>
  <div class="mobile-topbar-spacer"></div>
</div>

<!-- Homepage AI Chat -->
<div class="home-chat" id="home-chat">
  <button class="home-chat-back" id="home-chat-back">
    <svg viewBox="0 0 16 16" fill="none" stroke="currentColor" stroke-width="1.8" stroke-linecap="round" stroke-linejoin="round"><path d="M10 12L6 8l4-4"/></svg>
    Back
  </button>
  <div class="home-chat-header-title">BibleVerse Chat</div>
  <div class="home-chat-inner">
    <div class="home-chat-welcome" id="home-chat-welcome">
      <div class="home-chat-title">What would you like to explore?</div>
      <button class="home-read-btn mobile-hide-btn" id="hc-read-bible">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" width="18" height="18">
          <path d="M2 3h6a4 4 0 014 4v14a3 3 0 00-3-3H2z"/>
          <path d="M22 3h-6a4 4 0 00-4 4v14a3 3 0 013-3h7z"/>
        </svg>
        Read the Bible with AI
      </button>
      <div class="mobile-suggestions" id="mobile-suggestions">
        <button class="mobile-chip" data-q="Is suffering redemptive?">Is suffering redemptive?</button>
        <button class="mobile-chip" data-q="Why does God permit evil?">Why does God permit evil?</button>
        <button class="mobile-chip" data-q="What separates man from God?">What separates man from God?</button>
      </div>
    </div>

    <div class="home-mode-toggle">
      <button id="home-mode-search" class="active">Search</button>
      <button id="home-mode-chat">Chat</button>
    </div>

    <div class="model-picker" id="model-picker" style="display:none;">
      <div class="model-picker-label">Choose your model</div>
      <div class="model-picker-cards">
        <button class="model-card" data-model="standard">
          <div class="model-card-name">Standard</div>
          <div class="model-card-desc">Balanced speed and quality</div>
        </button>
        <button class="model-card" data-model="max">
          <div class="model-card-name">Max</div>
          <div class="model-card-desc">Best quality, slower</div>
        </button>
        <button class="model-card" data-model="genius">
          <div class="model-card-name"><em>Genius Mode</em></div>
          <div class="model-card-desc">Philosophical, high-IQ</div>
        </button>
      </div>
    </div>
    <div class="home-chat-messages" id="home-chat-messages" style="display:none;"></div>
    <div id="home-search-results" style="display:none;">
      <button class="search-back-btn" id="search-back-btn">
        <svg width="12" height="12" viewBox="0 0 16 16" fill="none"><path d="M10 2L4 8l6 6" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/></svg>
        Back
      </button>
      <div id="home-search-status"></div>
      <div id="home-search-results-desc"></div>
      <div id="home-search-results-list"></div>
    </div>
    <div class="search-loading-bar" id="search-loading-bar">
      <div class="search-loading-dots"><span></span><span></span><span></span></div>
      <div class="search-loading-text" id="search-loading-text">Loading search model</div>
      <div class="search-loading-track"><div class="search-loading-fill" id="search-loading-fill"></div></div>
    </div>
    <div class="home-chat-model-loading" id="home-chat-model-loading">
      <div class="rcml-inner">
        <div class="rcml-dots"><span></span><span></span><span></span></div>
        <div class="rcml-text" id="hcml-text">Loading model</div>
        <div class="rcml-bar-wrap"><div class="rcml-bar" id="hcml-bar"></div></div>
        <div class="rcml-sub">Loading your own personal model locally  which takes a few seconds  so that your conversation is secure.</div>
      </div>
    </div>
    <div class="home-chat-input-area">
      <div class="home-search-footer" id="home-search-footer">
        <div class="home-search-mode-toggle">
          <button id="home-mode-verses" class="active">Verses</button>
          <button id="home-mode-passages">Passages</button>
        </div>
        <div class="search-filter-wrap" id="search-filter-wrap">
          <button class="search-filter-btn" id="search-filter-btn">
            <svg width="12" height="12" viewBox="0 0 16 16" fill="none" stroke="currentColor" stroke-width="1.6" stroke-linecap="round"><path d="M2 4h12M4 8h8M6 12h4"/></svg>
            <span id="search-filter-label">All books</span>
          </button>
        </div>
        <button class="stats-info-btn" id="search-info-btn" title="About search">i</button>
      </div>
      <div class="home-chat-input-footer" id="home-chat-footer">
        <div class="home-chat-model" id="home-chat-model-wrap">
          <div class="cd-wrap" id="cd-home-model">
            <button class="cd-trigger" id="cd-home-model-trigger">
              <span>Logos Standard</span>
              <svg class="cd-chev" viewBox="0 0 10 6"><path d="M1 1l4 4 4-4" stroke="currentColor" stroke-width="1.5" fill="none" stroke-linecap="round"/></svg>
            </button>
            <div class="cd-menu" id="cd-home-model-menu"></div>
          </div>
        </div>
        <button class="stats-info-btn" id="chat-info-btn" title="About chat">i</button>
      </div>
      <div class="mobile-model-label" id="mobile-model-label">Logos</div>
      <div class="home-chat-input-wrap">
        <input type="text" id="home-chat-input" placeholder="Enter any text..." autocomplete="off" spellcheck="false">
        <button id="home-chat-send" class="home-chat-send" aria-label="Send">
          <svg width="16" height="16" viewBox="0 0 16 16" fill="none"><path d="M8 14V2M8 2L3 7M8 2l5 5" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/></svg>
        </button>
        <button id="home-chat-stop" class="home-chat-stop" aria-label="Stop">
          <svg width="14" height="14" viewBox="0 0 14 14" fill="none"><rect x="2" y="2" width="10" height="10" rx="2" fill="currentColor"/></svg>
        </button>
      </div>
      <span class="home-chat-disclaimer" id="home-chat-disclaimer" style="display:none;"></span>
    </div>
  </div>
</div>
</div>

<div class="home-footer">
  BibleVerse (Beta) <span class="mobile-hide">&nbsp;&nbsp;&middot;&nbsp;&nbsp; built by <a href="https://gregorykyro.com" target="_blank">Gregory W. Kyro, Ph.D.</a></span> &nbsp;&nbsp;&middot;&nbsp;&nbsp;  2026
</div>

<!-- Methodology modal -->
<div class="methodology-overlay" id="methodology-overlay">
<div class="methodology">
  <button class="methodology-close" id="methodology-close">&#x2715;</button>
  <h2 style="cursor:default;">About the sphere</h2>
  <div id="methodology-content">

  <div class="method-block">
    <h3>Sphere visualization</h3>
    <p>
      The 3D sphere displays <b id="leg-verse-count-meth">31,102</b> vertices (one per verse) and
      <b id="leg-edge-count-meth"></b> cross-reference edges.
    </p>
    <p style="margin-top:0.5rem;">
      <b>Vertices:</b>  Old Testament (39 books)   New Testament (27 books). Color encodes canonical book order
      along a gradient from blue (Genesis) through red to gold (Revelation).
    </p>
    <p style="margin-top:0.5rem;">
      <b>Edges:</b> Intra-testament (OTOT, NTNT)  <b id="leg-intra-count"></b> 
      Inter-testament (OTNT)  <b id="leg-inter-count"></b>.
      Cross-references sourced from <a href="https://www.openbible.info/labs/cross-references/" target="_blank" style="color:#c9a84c">openbible.info</a>.
    </p>
  </div>

  <div class="method-block">
    <h3>Sentence embedding</h3>
    <p>
      Let \(\mathcal{V} = \{v_1, \ldots, v_{31102}\}\) denote the KJV verse corpus.
      Each verse is encoded via a sentence transformer fine-tuned specifically on biblical text
      (<a href="https://huggingface.co/odunola/sentence-transformers-bible-reference-final" target="_blank" style="color:#c9a84c">odunola/sentence-transformers-bible-reference-final</a>,
      109M parameters, 12 transformer layers, MPNet architecture).
      The model was contrastively trained on 929K biblical sentence pairs using cosine similarity loss,
      learning to place theologically related passages close together in the embedding space:
    </p>
    $$\phi : \mathcal{V} \to \mathbb{R}^{768}, \qquad \phi(v_i) = \mathrm{MeanPool}\!\bigl(\mathrm{MPNet}(\mathrm{tokenize}(v_i))\bigr)$$
    <p>
      Unlike general-purpose encoders trained on web text, this model's latent space
      separates verses by biblical meaning  prophecy, typology, thematic parallel,
      and doctrinal correspondence  rather than surface vocabulary overlap.
    </p>
  </div>

  <div class="method-block">
    <h3>Dimensionality reduction</h3>
    <p>
      The embedding matrix \(\Phi \in \mathbb{R}^{31102 \times 768}\) is reduced to
      3 dimensions via UMAP, which minimizes the fuzzy set cross-entropy between
      high-dimensional affinities \(w_{ij}\) and low-dimensional affinities \(q_{ij}\):
    </p>
    $$\mathcal{L}_{\text{UMAP}} = \sum_{i \neq j} \left[ w_{ij} \ln \frac{w_{ij}}{q_{ij}} + (1 - w_{ij}) \ln \frac{1 - w_{ij}}{1 - q_{ij}} \right]$$
    <p>
      where \(w_{ij} = \exp\!\bigl(-({d(\phi_i, \phi_j) - \rho_i})/{\sigma_i}\bigr)\)
      captures local metric structure in the ambient space, with
      \(\texttt{n\_neighbors}=15\), \(\texttt{min\_dist}=0.1\), \(\texttt{metric}=\text{cosine}\).
    </p>
  </div>

  <div class="method-block">
    <h3>Spherical projection</h3>
    <p>
      The 3D UMAP coordinates \(\mathbf{x}_i \in \mathbb{R}^3\) are centered and
      normalized onto the unit 2-sphere:
    </p>
    $$\hat{\mathbf{x}}_i = \frac{\mathbf{x}_i - \bar{\mathbf{x}}}{\|\mathbf{x}_i - \bar{\mathbf{x}}\|_2} \;\in\; S^2$$
    <p>
      This preserves angular relationships: semantically similar verses cluster
      into regions on the sphere, while distant passages occupy opposite hemispheres.
    </p>
  </div>

  <div class="method-block">
    <h3>Cross-references</h3>
    <p>
      Arcs represent scholarly cross-references from the
      <a href="https://www.openbible.info/labs/cross-references/" target="_blank" style="color:#c9a84c">openbible.info</a>
      dataset (Christoph R&ouml;mhild, public domain). Each entry connects two
      verses identified by biblical scholars as linked via quotation, allusion,
      typological parallel, or prophecy&ndash;fulfillment, weighted by community
      vote count \(n_{\text{votes}}\). The homepage slider filters arcs by
      \(n_{\text{votes}} \geq \tau\), where \(\tau\) is user-selected.
    </p>
  </div>

  <div class="method-block">
    <h3>Arc geometry</h3>
    <p>
      For two sphere points \(\hat{\mathbf{x}}_i, \hat{\mathbf{x}}_j \in S^2\),
      the arc midpoint is computed via normalized averaging and bowed outward
      by a height proportional to angular separation:
    </p>
    $$\mathbf{m}_{ij} = \frac{\hat{\mathbf{x}}_i + \hat{\mathbf{x}}_j}{\|\hat{\mathbf{x}}_i + \hat{\mathbf{x}}_j\|} \cdot (1 + h), \qquad h = h_{\min} + (h_{\max} - h_{\min}) \cdot \frac{\theta_{ij}}{\pi}$$
    <p>
      where \(\theta_{ij} = \arccos(\hat{\mathbf{x}}_i \cdot \hat{\mathbf{x}}_j)\) is the
      geodesic angular distance. This ensures short-range references hug the surface
      while long-range references arc prominently outward.
    </p>
  </div>
  </div>
</div>
</div>

<script>
document.getElementById('stats-info-btn').addEventListener('click', function() {
  document.getElementById('methodology-overlay').classList.add('open');
});
document.getElementById('methodology-close').addEventListener('click', function() {
  document.getElementById('methodology-overlay').classList.remove('open');
});
document.getElementById('methodology-overlay').addEventListener('click', function(e) {
  if (e.target === this) this.classList.remove('open');
});
</script>

<!-- Search methodology modal -->
<div class="methodology-overlay" id="search-methodology-overlay">
<div class="methodology">
  <button class="methodology-close" id="search-methodology-close">&#x2715;</button>
  <h2 style="cursor:default;">About search</h2>
  <div class="method-block">
    <p>
      The search bar performs real-time semantic retrieval using the <em>same</em>
      Bible-trained MPNet transformer that generates the sphere layout. The user's
      query \(q\) is encoded to a 768-dimensional embedding \(\phi(q)\) via
      <a href="https://huggingface.co/odunola/sentence-transformers-bible-reference-final" target="_blank" style="color:#c9a84c">ONNX Runtime Web</a>,
      running the full 109M-parameter model directly in the browser (WASM backend).
    </p>
    <p>
      Verse rankings are determined by cosine similarity in the embedding space:
    </p>
    $$\text{sim}(q, v_i) = \frac{\phi(q) \cdot \phi(v_i)}{\|\phi(q)\| \, \|\phi(v_i)\|} = \phi(q)^{\!\top} \hat\phi(v_i)$$
    <p>
      where \(\hat\phi(v_i)\) denotes the L2-normalised verse embedding (pre-computed and
      shipped as a 23.9 MB uint8-quantised binary). Since both query and verse vectors are
      normalised, the dot product is equivalent to cosine similarity. This is <em>not</em>
      keyword matching  it captures theological and semantic proximity: a query like
      <em>"I feel lost"</em> surfaces verses about wandering, despair, and seeking guidance,
      even when no query terms appear verbatim.
    </p>
  </div>
</div>
</div>

<!-- Chat methodology modal -->
<div class="methodology-overlay" id="chat-methodology-overlay">
<div class="methodology">
  <button class="methodology-close" id="chat-methodology-close">&#x2715;</button>
  <h2 style="cursor:default;">About chat</h2>
  <div class="method-block">
    <h3>Client-side LLM inference</h3>
    <p>
      Chat runs a large language model <em>entirely in your browser</em>  no server, no API calls,
      no data leaving your device. This is achieved via
      <a href="https://github.com/mlc-ai/web-llm" target="_blank" style="color:#c9a84c">MLC Web-LLM</a>,
      which compiles transformer models to WebGPU shaders using
      <a href="https://tvm.apache.org/" target="_blank" style="color:#c9a84c">Apache TVM</a>'s
      machine learning compilation stack. The model weights are downloaded once and cached in
      your browser's storage.
    </p>
  </div>
  <div class="method-block">
    <h3>Available models</h3>
    <p>
      All models are 4-bit quantised (q4f16_1) to fit within browser VRAM constraints
      while preserving output quality. The available architectures are:
    </p>
    <ul style="margin: 0.8rem 0; padding-left: 1.4rem; font-size: 0.82rem; color: rgba(232,228,220,0.6); line-height: 1.9;">
      <li><b style="color:rgba(232,228,220,0.75);">Logos Standard</b>  Based on Google Gemma 2 2B. 2.6B parameters, 2.0 GB VRAM. Strong quality-to-size ratio, recommended default.</li>
      <li><b style="color:rgba(232,228,220,0.75);">Logos Max</b>  Based on Microsoft Phi 3.5 Mini. 3.8B parameters, 3.7 GB VRAM. Strongest reasoning capability, best for complex questions.</li>
      <li><b style="color:rgba(232,228,220,0.75);">Max (Genius Mode)</b>  Same model as Logos Max with a distinctive philosophical voice inspired by Dostoevsky and Nietzsche. Blunt, piercing, high-IQ responses.</li>
    </ul>
  </div>
  <div class="method-block">
    <h3>Hardware requirements</h3>
    <p>
      WebGPU is required for GPU-accelerated matrix operations. This is supported in
      Chrome 113+, Edge 113+, and Safari 18+ (macOS Sequoia). Firefox does not yet ship
      WebGPU by default. On unsupported browsers, you can provide an
      <a href="https://platform.openai.com/api-keys" target="_blank" style="color:#c9a84c">OpenAI API key</a>
      in the reader settings to use server-side inference instead.
    </p>
  </div>
  <div class="method-block">
    <h3>Privacy</h3>
    <p>
      When using local inference, the full forward pass  embedding lookup, multi-head
      self-attention, feed-forward layers, and autoregressive token sampling  executes
      on your GPU via WebGPU compute shaders. No tokens, prompts, or completions are
      transmitted over the network. Your conversation exists solely in browser memory and
      is discarded when you leave the page.
    </p>
  </div>
</div>
</div>

<script>
document.getElementById('search-info-btn').addEventListener('click', function() {
  document.getElementById('search-methodology-overlay').classList.add('open');
});
document.getElementById('search-methodology-close').addEventListener('click', function() {
  document.getElementById('search-methodology-overlay').classList.remove('open');
});
document.getElementById('search-methodology-overlay').addEventListener('click', function(e) {
  if (e.target === this) this.classList.remove('open');
});
document.getElementById('chat-info-btn').addEventListener('click', function() {
  document.getElementById('chat-methodology-overlay').classList.add('open');
});
document.getElementById('chat-methodology-close').addEventListener('click', function() {
  document.getElementById('chat-methodology-overlay').classList.remove('open');
});
document.getElementById('chat-methodology-overlay').addEventListener('click', function(e) {
  if (e.target === this) this.classList.remove('open');
});
</script>

<!-- Representative verses (hidden) -->
<div class="rep-verses" style="display:none;">
  <h2>Representative Verse per Book</h2>
  <p class="rep-sub">
    For each of the 66 books, the mean embedding of all its verses is computed.
    The single verse closest to this centroid (by cosine similarity) is shown  the verse
    that best represents the semantic center of the book.
  </p>

  <div class="rv-group">
    <button class="rv-toggle" data-target="rv-ot-list">Old Testament <span class="rv-arrow"></span></button>
    <div class="rv-search-wrap" id="rv-ot-search-wrap" style="display:none;">
      <input type="text" class="rv-search" id="rv-ot-search" placeholder="Search OT books..." autocomplete="off" spellcheck="false">
    </div>
    <div class="rv-list" id="rv-ot-list" style="display:none;"></div>
  </div>

  <div class="rv-group">
    <button class="rv-toggle" data-target="rv-nt-list">New Testament <span class="rv-arrow"></span></button>
    <div class="rv-search-wrap" id="rv-nt-search-wrap" style="display:none;">
      <input type="text" class="rv-search" id="rv-nt-search" placeholder="Search NT books..." autocomplete="off" spellcheck="false">
    </div>
    <div class="rv-list" id="rv-nt-list" style="display:none;"></div>
  </div>
</div>

<!-- Module cards (hidden) -->
<div class="below-fold" style="display:none;">
  <main>
    <div class="section-label">Explore</div>

    <div class="module-grid">
      <a href="map.html" class="module-card">
        <div class="module-num">01</div>
        <h2>Semantic Map</h2>
        <p>
          Every verse embedded and projected into 2D. A latent-space
          atlas revealing which passages live near each other in
          meaning-space, regardless of canonical position.
        </p>
        <div class="module-enter">Enter &rarr;</div>
      </a>
      <a href="network.html" class="module-card">
        <div class="module-num">02</div>
        <h2>Entity Network</h2>
        <p>
          People, places, and concepts extracted and connected by
          co-occurrence. A force-directed graph exposing the
          relational skeleton of the text.
        </p>
        <div class="module-enter">Enter &rarr;</div>
      </a>
      <a href="complexity.html" class="module-card">
        <div class="module-num">03</div>
        <h2>Complexity</h2>
        <p>
          Shannon entropy, compression ratios, lexical diversity,
          and cross-book similarity. The quantitative fingerprint of
          each book, compared across genres.
        </p>
        <div class="module-enter">Enter &rarr;</div>
      </a>
    </div>

    <div class="manifesto">
      <h3>What is this</h3>
      <p>
        This project applies standard NLP and information-theory methods to
        the King James Bible &mdash; a public-domain English translation of
        historically significant texts. The goal is structural: to surface
        patterns, clusters, and relationships that are difficult to perceive
        through linear reading alone. Every visualization is paired with the
        mathematics behind it. Explore the text, then decide what you think.
      </p>
    </div>
  </main>

  <footer class="hero-footer">
    King James Version (1769) + Berean Standard Bible &middot; Public Domain &middot; Embeddings: Bible-trained MPNet (768-dim) &middot; Visualization: Plotly + D3
  </footer>
</div>

<div class="passage-modal-overlay" id="passage-modal-overlay">
  <div class="passage-modal">
    <button class="passage-modal-close" id="passage-modal-close">&#x2715;</button>
    <div class="passage-modal-ref" id="passage-modal-ref"></div>
    <div class="passage-modal-title" id="passage-modal-title"></div>
    <div class="pm-translation-toggle">
      <button id="pm-kjv" class="active">Classic (King James, 1769)</button>
      <button id="pm-bsb">Modern (Berean Standard)</button>
    </div>
    <div class="passage-modal-body" id="passage-modal-body"></div>
    <div class="passage-modal-body" id="passage-modal-body-bsb" style="display:none;"></div>
    <button class="pm-read-context" id="pm-read-context">
      <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M2 3h6a4 4 0 0 1 4 4v14a3 3 0 0 0-3-3H2z"/><path d="M22 3h-6a4 4 0 0 0-4 4v14a3 3 0 0 1 3-3h7z"/></svg>
      Read in context
    </button>
  </div>
</div>

<div class="reader-transition" id="reader-transition">
  <div class="rt-glow"></div>
  <div class="rt-bible">
    <div class="rt-book">
      <div class="rt-spine">
        <div class="rt-spine-decor">
          <div class="rt-line"></div>
          <svg class="rt-cross-icon" viewBox="0 0 28 28" fill="none">
            <rect x="12" y="2" width="4" height="24" rx="1" fill="url(#rt-gold)"/>
            <rect x="4" y="9" width="20" height="4" rx="1" fill="url(#rt-gold)"/>
            <defs><linearGradient id="rt-gold" x1="14" y1="2" x2="14" y2="26" gradientUnits="userSpaceOnUse">
              <stop offset="0%" stop-color="#f5e08c"/>
              <stop offset="50%" stop-color="#c9a84c"/>
              <stop offset="100%" stop-color="#8a6d2e"/>
            </linearGradient></defs>
          </svg>
          <div class="rt-label">Holy Bible</div>
          <div class="rt-label-sub">King James Version</div>
          <div class="rt-line"></div>
        </div>
      </div>
      <div class="rt-cover">
        <div class="rt-cover-inner">
          <div class="rt-spine-decor">
            <div class="rt-line"></div>
            <svg class="rt-cross-icon" viewBox="0 0 28 28" fill="none">
              <rect x="12" y="2" width="4" height="24" rx="1" fill="url(#rt-gold)"/>
              <rect x="4" y="9" width="20" height="4" rx="1" fill="url(#rt-gold)"/>
            </svg>
            <div class="rt-label">Holy Bible</div>
            <div class="rt-label-sub">King James Version</div>
            <div class="rt-line"></div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<div class="reader-overlay" id="reader-overlay">
  <div class="reader-topbar">
    <div class="reader-topbar-left">
      <button class="reader-close" id="reader-close">&#x2715;</button>
    </div>
    <div class="reader-topbar-center">
      <div class="reader-topbar-title">
        <div class="cd-wrap" id="cd-book">
          <button class="cd-trigger" id="cd-book-trigger">
            <span>Genesis</span>
            <svg class="cd-chev" viewBox="0 0 10 6"><path d="M1 1l4 4 4-4" stroke="currentColor" stroke-width="1.5" fill="none" stroke-linecap="round"/></svg>
          </button>
          <div class="cd-menu" id="cd-book-menu">
            <div class="cd-menu-search"><input type="text" placeholder="Search books..." id="cd-book-search" autocomplete="off" spellcheck="false"></div>
            <div id="cd-book-list"></div>
          </div>
        </div>
        <div class="reader-chapter-nav">
          <button id="reader-prev">&#x2039;</button>
          <div class="cd-wrap" id="cd-chapter">
            <button class="cd-trigger" id="cd-chapter-trigger">
              <span>Chapter 1</span>
              <svg class="cd-chev" viewBox="0 0 10 6"><path d="M1 1l4 4 4-4" stroke="currentColor" stroke-width="1.5" fill="none" stroke-linecap="round"/></svg>
            </button>
            <div class="cd-menu" id="cd-chapter-menu"></div>
          </div>
          <button id="reader-next">&#x203A;</button>
        </div>
      </div>
    </div>
    <div class="reader-topbar-right">
      <div class="reader-tl-wrap">
        <span class="reader-tl-label">English translation</span>
        <div class="reader-tl-toggle">
          <button id="reader-kjv" class="active">Classic (1769)</button>
          <button id="reader-bsb">Modern (2020)</button>
        </div>
      </div>
    </div>
  </div>
  <div class="reader-body">
    <div class="reader-content" id="reader-content">
      <div class="reader-inner" id="reader-inner"></div>
    </div>
    <div class="reader-sel-tooltip" id="reader-sel-tooltip">
      <button id="reader-sel-ask">
        <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"/></svg>
        Ask AI
      </button>
    </div>
    <div class="reader-chat" id="reader-chat">
      <div class="reader-chat-header" id="reader-chat-header" style="display:none;">
        <div class="cd-wrap" id="cd-model">
          <button class="cd-trigger" id="cd-model-trigger">
            <span>Logos Standard</span>
            <svg class="cd-chev" viewBox="0 0 10 6"><path d="M1 1l4 4 4-4" stroke="currentColor" stroke-width="1.5" fill="none" stroke-linecap="round"/></svg>
          </button>
          <div class="cd-menu" id="cd-model-menu"></div>
        </div>
        <button id="reader-chat-settings-btn" title="Settings">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="3"/><path d="M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 1 1-2.83 2.83l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 1 1-4 0v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 1 1-2.83-2.83l.06-.06A1.65 1.65 0 0 0 4.68 15a1.65 1.65 0 0 0-1.51-1H3a2 2 0 1 1 0-4h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 1 1 2.83-2.83l.06.06A1.65 1.65 0 0 0 9 4.68a1.65 1.65 0 0 0 1-1.51V3a2 2 0 1 1 4 0v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 1 1 2.83 2.83l-.06.06A1.65 1.65 0 0 0 19.4 9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 1 1 0 4h-.09a1.65 1.65 0 0 0-1.51 1z"/></svg>
        </button>
      </div>
      <div class="reader-chat-model-loading" id="reader-chat-model-loading">
        <div class="rcml-inner">
          <div class="rcml-dots"><span></span><span></span><span></span></div>
          <div class="rcml-text" id="rcml-text">Loading model</div>
          <div class="rcml-bar-wrap"><div class="rcml-bar" id="rcml-bar"></div></div>
          <div class="rcml-sub">Loading your own personal model locally  which takes a few seconds  so that your conversation is secure.</div>
        </div>
      </div>
      <div class="reader-chat-settings" id="reader-chat-settings" style="display:none;">
        <div class="reader-chat-settings-msg">
          Optional: use your own <a href="https://platform.openai.com/api-keys" target="_blank" rel="noopener">OpenAI API key</a> for faster responses.
        </div>
        <div class="reader-chat-key-wrap">
          <input type="password" id="reader-chat-api-key" placeholder="sk-...">
          <button id="reader-chat-key-save">Save</button>
        </div>
        <div class="reader-chat-settings-hint">Without a key, AI runs locally in your browser via WebGPU.</div>
      </div>
      <div class="reader-model-picker" id="reader-model-picker">
        <div class="rmp-label">Choose your model</div>
        <div class="rmp-cards">
          <button class="rmp-card" data-model="standard">
            <div class="rmp-card-name">Standard</div>
            <div class="rmp-card-desc">Balanced speed and quality</div>
          </button>
          <button class="rmp-card" data-model="max">
            <div class="rmp-card-name">Max</div>
            <div class="rmp-card-desc">Best quality, slower</div>
          </button>
          <button class="rmp-card" data-model="genius">
            <div class="rmp-card-name"><em>Genius Mode</em></div>
            <div class="rmp-card-desc">Philosophical, high-IQ</div>
          </button>
        </div>
        <div class="rmp-hint">Your conversation is private  AI runs locally in your browser.</div>
      </div>
      <div class="reader-chat-messages" id="reader-chat-messages" style="display:none;">
        <div class="reader-chat-empty">Ask anything about the text you're reading.</div>
      </div>
      <div class="reader-chat-input-wrap" id="reader-chat-input-wrap" style="display:none;">
        <textarea id="reader-chat-input" placeholder="Ask a question..." rows="1"></textarea>
        <button id="reader-chat-send" title="Send">
          <svg viewBox="0 0 24 24" fill="currentColor"><path d="M2.01 21L23 12 2.01 3 2 10l15 2-15 2z"/></svg>
        </button>
      </div>
      <div class="reader-chat-disclaimer" id="reader-chat-disclaimer" style="display:none;">AI runs locally in your browser. Your messages stay on your device.</div>
    </div>
  </div>
</div>

<div class="search-filter-backdrop" id="search-filter-backdrop"></div>
<div class="search-filter-dropdown" id="search-filter-dropdown">
  <div class="sfd-top-row">
    <div class="sfd-header">Filter by book</div>
    <button class="sfd-done" id="sfd-done">Done</button>
  </div>
  <div class="sfd-columns">
    <div class="sfd-section">
      <label class="sfd-toggle" id="sfd-ot-toggle">
        <span>Old Testament</span>
        <span class="sfd-track on"><input type="checkbox" checked></span>
      </label>
      <div class="sfd-books" id="sfd-ot-books"></div>
    </div>
    <div class="sfd-divider-v"></div>
    <div class="sfd-section">
      <label class="sfd-toggle" id="sfd-nt-toggle">
        <span>New Testament</span>
        <span class="sfd-track on"><input type="checkbox" checked></span>
      </label>
      <div class="sfd-books" id="sfd-nt-books"></div>
    </div>
  </div>
</div>
<!-- Onboarding walkthrough -->
<div class="walkthrough-overlay" id="wt-overlay"></div>
<div class="walkthrough-highlight" id="wt-highlight" style="display:none;"></div>
<div class="walkthrough-tooltip" id="wt-tooltip">
  <div class="walkthrough-step-label" id="wt-step-label"></div>
  <div class="walkthrough-title" id="wt-title"></div>
  <div class="walkthrough-desc" id="wt-desc"></div>
  <div class="walkthrough-actions">
    <button class="walkthrough-skip" id="wt-skip">Skip</button>
    <div class="walkthrough-dots" id="wt-dots"></div>
    <button class="walkthrough-next" id="wt-next">Next</button>
  </div>
</div>
<script>
(function () {
  if (localStorage.getItem('bv_walkthrough_done')) return;
  if (window.innerWidth <= 800) return;

  var steps = [
    {
      target: 'home-mode-search',
      title: 'Search',
      desc: 'Enter any word, phrase, or idea to find the most relevant verses and passages in the Bible.',
      arrow: 'top',
      offsetY: 12
    },
    {
      target: 'home-mode-chat',
      title: 'Chat',
      desc: 'Ask questions about any verse, topic, or theme and get responses from your own personal AI assistant.',
      arrow: 'top',
      offsetY: 12
    },
    {
      target: 'hc-read-bible',
      title: 'Read the Bible with AI',
      desc: 'Read the Bible alongside your own personal AI assistant for real-time dialogue.',
      arrow: 'bottom',
      offsetY: -12
    }
  ];

  var current = 0;
  var overlay = document.getElementById('wt-overlay');
  var highlight = document.getElementById('wt-highlight');
  var tooltip = document.getElementById('wt-tooltip');
  var titleEl = document.getElementById('wt-title');
  var descEl = document.getElementById('wt-desc');
  var labelEl = document.getElementById('wt-step-label');
  var dotsEl = document.getElementById('wt-dots');
  var nextBtn = document.getElementById('wt-next');
  var skipBtn = document.getElementById('wt-skip');

  function buildDots() {
    dotsEl.innerHTML = '';
    for (var i = 0; i < steps.length; i++) {
      var d = document.createElement('span');
      if (i === current) d.className = 'active';
      dotsEl.appendChild(d);
    }
  }

  function showStep(idx) {
    current = idx;
    var step = steps[idx];
    var el = document.getElementById(step.target);
    if (!el) { finish(); return; }

    var rect = el.getBoundingClientRect();
    var pad = 8;

    highlight.style.display = 'block';
    highlight.style.left = (rect.left - pad) + 'px';
    highlight.style.top = (rect.top - pad) + 'px';
    highlight.style.width = (rect.width + pad * 2) + 'px';
    highlight.style.height = (rect.height + pad * 2) + 'px';

    titleEl.textContent = step.title;
    descEl.textContent = step.desc;
    nextBtn.textContent = idx === steps.length - 1 ? 'Get started' : 'Next';
    buildDots();

    tooltip.className = 'walkthrough-tooltip arrow-' + step.arrow;

    var tw = 320;
    var tx = rect.left + rect.width / 2 - tw / 2;
    tx = Math.max(16, Math.min(tx, window.innerWidth - tw - 16));

    var ty;
    if (step.arrow === 'top') {
      ty = rect.bottom + pad + step.offsetY;
    } else {
      ty = rect.top - pad + step.offsetY;
    }

    tooltip.style.left = tx + 'px';

    if (step.arrow === 'top') {
      tooltip.style.top = ty + 'px';
      tooltip.style.bottom = 'auto';
    } else {
      tooltip.style.bottom = (window.innerHeight - ty) + 'px';
      tooltip.style.top = 'auto';
    }

    var arrowLeft = rect.left + rect.width / 2 - tx;
    arrowLeft = Math.max(20, Math.min(arrowLeft, tw - 20));
    tooltip.style.setProperty('--arrow-left', arrowLeft + 'px');

    requestAnimationFrame(function () {
      tooltip.classList.add('visible');
    });
  }

  function finish() {
    tooltip.classList.remove('visible');
    overlay.classList.remove('active');
    highlight.style.display = 'none';
    tooltip.style.display = 'none';
    localStorage.setItem('bv_walkthrough_done', '1');
    setTimeout(function () {
      overlay.remove();
      highlight.remove();
      tooltip.remove();
    }, 500);
  }

  nextBtn.addEventListener('click', function () {
    tooltip.classList.remove('visible');
    if (current < steps.length - 1) {
      setTimeout(function () { showStep(current + 1); }, 300);
    } else {
      finish();
    }
  });

  skipBtn.addEventListener('click', finish);
  overlay.addEventListener('click', finish);

  // Start walkthrough after sphere loads
  function tryStart() {
    var el = document.getElementById(steps[0].target);
    if (el && el.offsetParent !== null) {
      overlay.classList.add('active');
      showStep(0);
    } else {
      setTimeout(tryStart, 500);
    }
  }
  setTimeout(tryStart, 5500);
})();
</script>

<script src="js/common.js"></script>
<script src="js/hero.js?v=20260228r"></script>
</body>
</html>
